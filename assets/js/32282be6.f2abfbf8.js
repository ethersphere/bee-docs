"use strict";(self.webpackChunkbee_docs=self.webpackChunkbee_docs||[]).push([[7231],{11470(e,n,t){t.d(n,{A:()=>N});var s=t(96540),a=t(34164),i=t(17559),r=t(23104),l=t(56347),c=t(205),d=t(57485),o=t(31682),h=t(70679);function p(e){var n,t;return null!=(n=null==(t=s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))?void 0:t.filter(Boolean))?n:[]}function u(e){const{values:n,children:t}=e;return(0,s.useMemo)(()=>{const e=null!=n?n:function(e){return p(e).map(e=>{let{props:{value:n,label:t,attributes:s,default:a}}=e;return{value:n,label:t,attributes:s,default:a}})}(t);return function(e){const n=(0,o.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map(e=>e.value).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e},[n,t])}function f(e){let{value:n,tabValues:t}=e;return t.some(e=>e.value===n)}function x(e){let{queryString:n=!1,groupId:t}=e;const a=(0,l.W6)(),i=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,d.aZ)(i),(0,s.useCallback)(e=>{if(!i)return;const n=new URLSearchParams(a.location.search);n.set(i,e),a.replace(Object.assign({},a.location,{search:n.toString()}))},[i,a])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,i=u(e),[r,l]=(0,s.useState)(()=>function(e){var n;let{defaultValue:t,tabValues:s}=e;if(0===s.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!f({value:t,tabValues:s}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+s.map(e=>e.value).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const a=null!=(n=s.find(e=>e.default))?n:s[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:i})),[d,o]=x({queryString:t,groupId:a}),[p,m]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[a,i]=(0,h.Dv)(t);return[a,(0,s.useCallback)(e=>{t&&i.set(e)},[t,i])]}({groupId:a}),j=(()=>{const e=null!=d?d:p;return f({value:e,tabValues:i})?e:null})();(0,c.A)(()=>{j&&l(j)},[j]);return{selectedValue:r,selectValue:(0,s.useCallback)(e=>{if(!f({value:e,tabValues:i}))throw new Error("Can't select invalid tab value="+e);l(e),o(e),m(e)},[o,m,i]),tabValues:i}}var j=t(92303);const b="tabList__CuJ",g="tabItem_LNqP";var w=t(74848);function v(e){let{className:n,block:t,selectedValue:s,selectValue:i,tabValues:l}=e;const c=[],{blockElementScrollPositionUntilNextRender:d}=(0,r.a_)(),o=e=>{const n=e.currentTarget,t=c.indexOf(n),a=l[t].value;a!==s&&(d(n),i(a))},h=e=>{var n;let t=null;switch(e.key){case"Enter":o(e);break;case"ArrowRight":{var s;const n=c.indexOf(e.currentTarget)+1;t=null!=(s=c[n])?s:c[0];break}case"ArrowLeft":{var a;const n=c.indexOf(e.currentTarget)-1;t=null!=(a=c[n])?a:c[c.length-1];break}}null==(n=t)||n.focus()};return(0,w.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},n),children:l.map(e=>{let{value:n,label:t,attributes:i}=e;return(0,w.jsx)("li",Object.assign({role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{c.push(e)},onKeyDown:h,onClick:o},i,{className:(0,a.A)("tabs__item",g,null==i?void 0:i.className,{"tabs__item--active":s===n}),children:null!=t?t:n}),n)})})}function y(e){let{lazy:n,children:t,selectedValue:i}=e;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=r.find(e=>e.props.value===i);return e?(0,s.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,w.jsx)("div",{className:"margin-top--md",children:r.map((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==i}))})}function T(e){const n=m(e);return(0,w.jsxs)("div",{className:(0,a.A)(i.G.tabs.container,"tabs-container",b),children:[(0,w.jsx)(v,Object.assign({},n,e)),(0,w.jsx)(y,Object.assign({},n,e))]})}function N(e){const n=(0,j.A)();return(0,w.jsx)(T,Object.assign({},e,{children:p(e.children)}),String(n))}},19365(e,n,t){t.d(n,{A:()=>r});t(96540);var s=t(34164);const a="tabItem_Ymn6";var i=t(74848);function r(e){let{children:n,hidden:t,className:r}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,s.A)(a,r),hidden:t,children:n})}},28453(e,n,t){t.d(n,{R:()=>r,x:()=>l});var s=t(96540);const a={},i=s.createContext(a);function r(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:n},e.children)}},58556(e,n,t){t.d(n,{A:()=>s});const s=t.p+"assets/images/disc-e885f00fdf9004bfcb502f11ae3d725c.jpg"},67239(e,n,t){t.d(n,{A:()=>s});const s=t.p+"assets/images/default-404-4bcfc018158eeaf18ada8562b30f1c45.jpg"},77728(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"develop/files","title":"Manage Files","description":"Swarm does not have a traditional filesystem \u2014 there are no mutable directories, in-place updates, or a built-in directory structure that preserves relationships between files. Instead, these capabilities are provided through the use of manifests, which map relative paths (such as /images/cat.jpg) to immutable Swarm content references. When you upload a directory, Bee creates a manifest automatically and returns its reference. Files can then be accessed using paths that are relative to that manifest reference, based on the original directory structure. This provides filesystem-like behavior for your data, and the directory structure can later be changed by publishing a new version of the manifest with the desired updates.","source":"@site/docs/develop/files.md","sourceDirName":"develop","slug":"/develop/files","permalink":"/docs/develop/files","draft":false,"unlisted":false,"editUrl":"https://github.com/ethersphere/docs.github.io/blob/master/docs/develop/files.md","tags":[],"version":"current","frontMatter":{"title":"Manage Files","id":"files","sidebar_label":"Manage Files"},"sidebar":"develop","previous":{"title":"Host a Webpage","permalink":"/docs/develop/host-your-website"},"next":{"title":"Website Routing","permalink":"/docs/develop/routing"}}');var a=t(74848),i=t(28453);t(11470),t(19365);const r={title:"Manage Files",id:"files",sidebar_label:"Manage Files"},l="Manage Files",c={},d=[{value:"Usage and Example Scripts",id:"usage-and-example-scripts",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Script 1: Upload Folder and Inspect Manifest",id:"script-1-upload-folder-and-inspect-manifest",level:2},{value:"Code Explanation",id:"code-explanation",level:3},{value:"Script 2: Adding a File to an Existing Manifest",id:"script-2-adding-a-file-to-an-existing-manifest",level:2},{value:"Explanation",id:"explanation",level:3},{value:"Script 3: Moving a File by Updating the Manifest",id:"script-3-moving-a-file-by-updating-the-manifest",level:2},{value:"Explanation",id:"explanation-1",level:3},{value:"Key Takeaways",id:"key-takeaways",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"manage-files",children:"Manage Files"})}),"\n",(0,a.jsxs)(n.p,{children:["Swarm does not have a traditional filesystem \u2014 there are no mutable directories, in-place updates, or a built-in directory structure that preserves relationships between files. Instead, these capabilities are provided through the use of ",(0,a.jsx)(n.a,{href:"/docs/develop/tools-and-features/manifests",children:"manifests"}),", which map relative paths (such as ",(0,a.jsx)(n.code,{children:"/images/cat.jpg"}),") to immutable Swarm content references. When you upload a directory, Bee creates a manifest automatically and returns its reference. Files can then be accessed using paths that are relative to that manifest reference, based on the original directory structure. This provides filesystem-like behavior for your data, and the directory structure can later be changed by publishing a new version of the manifest with the desired updates."]}),"\n",(0,a.jsx)(n.h2,{id:"usage-and-example-scripts",children:"Usage and Example Scripts"}),"\n",(0,a.jsx)(n.p,{children:"This section demonstrates how manifests enable filesystem-like features on Swarm, including uploading directories and modifying file paths."}),"\n",(0,a.jsxs)(n.p,{children:["The full working scripts are available in the ",(0,a.jsx)(n.a,{href:"https://github.com/ethersphere/examples",children:"examples"})," repo:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/ethersphere/examples/blob/main/filesystem/script-01.js",children:(0,a.jsx)(n.code,{children:"script-01.js"})})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/ethersphere/examples/blob/main/filesystem/script-02.js",children:(0,a.jsx)(n.code,{children:"script-02.js"})})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/ethersphere/examples/blob/main/filesystem/script-03.js",children:(0,a.jsx)(n.code,{children:"script-03.js"})})}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{title:"Website routing",type:"info",children:(0,a.jsxs)(n.p,{children:["Manifests are also used for website routing (index documents, clean URLs, error pages, redirects). If you are building a website, see the ",(0,a.jsx)(n.a,{href:"/docs/develop/routing",children:"Routing guide"}),"."]})}),"\n",(0,a.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Node.js (v20+ recommended)"}),"\n",(0,a.jsx)(n.li,{children:"npm"}),"\n",(0,a.jsx)(n.li,{children:"A running Bee node (local or remote)"}),"\n",(0,a.jsx)(n.li,{children:"A funded postage batch"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Clone the ",(0,a.jsx)(n.a,{href:"https://github.com/ethersphere/examples",children:"examples"})," repo and navigate to the manifests directory:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/ethersphere/examples.git\ncd examples/filesystem\nnpm install\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Update the ",(0,a.jsx)(n.code,{children:"<BATCH_ID>"})," in the ",(0,a.jsx)(n.code,{children:".env"})," file with a valid batch ID, and make sure that ",(0,a.jsx)(n.code,{children:"BEE_URL"})," is set to the RPC endpoint for your Bee node:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"BEE_URL=http://localhost:1633 # or http://127.0.0.1:1633  \nBATCH_ID=<BATCH_ID>\nUPLOAD_DIR=./folder\nSCRIPT_02_MANIFEST=<MANIFEST_REFERENCE>\nSCRIPT_03_MANIFEST=<MANIFEST_REFERENCE>\n"})}),"\n",(0,a.jsx)(n.h2,{id:"script-1-upload-folder-and-inspect-manifest",children:"Script 1: Upload Folder and Inspect Manifest"}),"\n",(0,a.jsx)(n.p,{children:"In this example, we simply upload a folder and print its manifest in a human readable format."}),"\n",(0,a.jsx)(n.p,{children:"Full script:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/ethersphere/examples/blob/main/filesystem/script-01.js",children:(0,a.jsx)(n.code,{children:"script-01.js"})})}),"\n"]}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsx)(n.p,{children:"Uploading is handled by a utility script:"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/ethersphere/examples/blob/main/utils/upload-directory.js",children:(0,a.jsx)(n.code,{children:"upload-directory.js"})})}),"\n"]}),(0,a.jsx)(n.p,{children:"The script:"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Uploads a directory using ",(0,a.jsx)(n.code,{children:"bee.uploadFilesFromDirectory"})]}),"\n",(0,a.jsx)(n.li,{children:"Returns the manifest reference and prints it to the terminal"}),"\n"]}),(0,a.jsx)(n.p,{children:"The directory upload utility script itself looks like this:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const { reference } = await bee.uploadFilesFromDirectory(batchId, path, options);\n"})}),(0,a.jsxs)(n.p,{children:["The returned ",(0,a.jsx)(n.code,{children:"reference"})," is for the ",(0,a.jsx)(n.strong,{children:"manifest itself"}),", not a file reference. Files must always be accessed ",(0,a.jsx)(n.em,{children:"through"})," this manifest, not directly through file references shown in the manifest."]})]}),"\n",(0,a.jsx)(n.p,{children:"Run the script:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"node script-01.js\n"})}),"\n",(0,a.jsx)(n.p,{children:"Script terminal output:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'[dotenv@17.2.3] injecting env (3) from .env -- tip: \u2699\ufe0f  override existing env vars with { override: true }\n\nUploaded directory: C:\\Users\\username\\Documents\\examples\\filesystem\\folder\n\nReference: http://127.0.0.1:1633/bzz/bf5fa30cf426fe9b646db8cb1dfcb8fd146096e6a86c1de2b266689346e703c8\n\nManifest reference: bf5fa30cf426fe9b646db8cb1dfcb8fd146096e6a86c1de2b266689346e703c8\nroot.txt: ROOT DIRECTORY\nsubfolder/nested.txt: NESTED DIRECTORY\n\n--- Manifest Tree ---\n{\n  "path": "",\n  "target": "0x0000000000000000000000000000000000000000000000000000000000000000",\n  "metadata": null,\n  "forks": {\n    "/": {\n      "path": "/",\n      "target": "0x0000000000000000000000000000000000000000000000000000000000000000",\n      "metadata": {\n        "website-index-document": "disc.jpg"\n      },\n      "forks": {}\n    },\n    "disc.jpg": {\n      "path": "disc.jpg",\n      "target": "0xc4df63219e294cf412b4ad77169c8c6a30077af1b4160c3db6d536fdb7cc91df",\n      "metadata": {\n        "Content-Type": "image/jpeg",\n        "Filename": "disc.jpg"\n      },\n      "forks": {}\n    },\n    "root.txt": {\n      "path": "root.txt",\n      "target": "0x45b3c65f9bcba9150247878baf9120836a51e62f61f7397270227a71ed94bfaf",\n      "metadata": {\n        "Content-Type": "text/plain; charset=utf-8",\n        "Filename": "root.txt"\n      },\n      "forks": {}\n    },\n    "subfolder/nested.txt": {\n      "path": "subfolder/nested.txt",\n      "target": "0x7ca0eb93e9b5802fa5c62ca8e2ef84fffa73a0f589ef68fc457beccbb2b1f84f",\n      "metadata": {\n        "Content-Type": "text/plain; charset=utf-8",\n        "Filename": "subfolder\\\\nested.txt"\n      },\n      "forks": {}\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Note that the manifest contains an entry for the file we specified as the index document in the upload options ",(0,a.jsx)(n.code,{children:'indexDocument: "disc.jpg"'}),"\nBoth ",(0,a.jsx)(n.code,{children:"indexDocument"})," and ",(0,a.jsx)(n.code,{children:"errorDocument"})," options will cause the manifest to be updated, but for more complex manifest manipulation we will need to do a bit more than setting some options. Keep reading to learn how."]})}),"\n",(0,a.jsx)(n.p,{children:"In the example output, you will find the following line (with your own unique manifest reference):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"Manifest reference: bf5fa30cf426fe9b646db8cb1dfcb8fd146096e6a86c1de2b266689346e703c8\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Update ",(0,a.jsx)(n.code,{children:"SCRIPT_02_MANIFEST"})," in your ",(0,a.jsx)(n.code,{children:".env"})," file with the printed ",(0,a.jsx)(n.strong,{children:"manifest reference"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"SCRIPT_02_MANIFEST=bf5fa30cf426fe9b646db8cb1dfcb8fd146096e6a86c1de2b266689346e703c8\n"})}),"\n",(0,a.jsx)(n.p,{children:"You will also see a formatted URL in the output:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"URL: http://localhost:1633/bzz/bf5fa30cf426fe9b646db8cb1dfcb8fd146096e6a86c1de2b266689346e703c8/\n"})}),"\n",(0,a.jsx)(n.p,{children:"Copy it and open in your browser. Since we specified an index document in our code, that's what you will see:"}),"\n",(0,a.jsx)(n.p,{children:"Index document option:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'indexDocument: "disc.jpg"\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.em,{children:"/img/disc.jpg:"}),"\n",(0,a.jsx)(n.img,{alt:"DISC diagram",src:t(58556).A+"",width:"3290",height:"1520"})]}),"\n",(0,a.jsxs)(n.p,{children:["Since we DID NOT specify the ",(0,a.jsx)(n.code,{children:"errorDocument"})," option, If you navigate to a non-existing document, you will just see your browser's default 404 error page:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"http://localhost:1633/bzz/bf5fa30cf426fe9b646db8cb1dfcb8fd146096e6a86c1de2b266689346e703c8/non-existing-content",children:"http://localhost:1633/bzz/bf5fa30cf426fe9b646db8cb1dfcb8fd146096e6a86c1de2b266689346e703c8/non-existing-content"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"browser default 404 page",src:t(67239).A+"",width:"1848",height:"1013"})}),"\n",(0,a.jsx)(n.p,{children:"We'll fix this later."}),"\n",(0,a.jsx)(n.h3,{id:"code-explanation",children:"Code Explanation"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Get path"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["First we get the path to our upload directory as specified in the ",(0,a.jsx)(n.code,{children:".env"})," file by the ",(0,a.jsx)(n.code,{children:"UPLOAD_DIR"})," variable:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"const directoryPath = path.join(__dirname, process.env.UPLOAD_DIR);\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Upload"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Then we upload the directory using our imported ",(0,a.jsx)(n.code,{children:"uploadDirectory"}),' utility function and set the index document to the "disc.jpg" in the root of our folder. Upon successful upload, the manifest reference is saved in ',(0,a.jsx)(n.code,{children:"reference"})," and printed to the terminal:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'const reference = await uploadDirectory(directoryPath, { indexDocument: "disc.jpg" });\nconsole.log("Manifest reference:", reference.toHex());\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"Print manifest"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"After upload, the manifest is loaded and printed:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const node = await MantarayNode.unmarshal(bee, reference)\nawait node.loadRecursively(bee)\nprintManifestJson(node)\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This produces a tree showing how paths map to Swarm references. To better understand the tree shown in the terminal output, refer to the ",(0,a.jsx)(n.a,{href:"/docs/develop/tools-and-features/manifests",children:"Manifests"})," page."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'"/": {\n      "path": "/",\n      "target": "0x0000000000000000000000000000000000000000000000000000000000000000",\n      "metadata": {\n        "website-index-document": "disc.jpg"\n      },\n      "forks": {}\n    },\n'})}),"\n",(0,a.jsx)(n.p,{children:"This entry ensures that a file will be served at the root directory rather than a 404 error."}),"\n",(0,a.jsx)(n.p,{children:"In the next script, we see how to update the manifest tree."}),"\n",(0,a.jsx)(n.h2,{id:"script-2-adding-a-file-to-an-existing-manifest",children:"Script 2: Adding a File to an Existing Manifest"}),"\n",(0,a.jsx)(n.p,{children:"The second script demonstrates how to add a new file without re-uploading the entire directory."}),"\n",(0,a.jsx)(n.p,{children:"Full script:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/ethersphere/examples/blob/main/filesystem/script-02.js",children:(0,a.jsx)(n.code,{children:"script-02.js"})})}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["Before running the second script, make sure that you have updated your ",(0,a.jsx)(n.code,{children:".env"})," variable ",(0,a.jsx)(n.code,{children:"SCRIPT_02_MANIFEST"})," with the manifest reference returned by the first script."]})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"node script-02.js\n"})}),"\n",(0,a.jsx)(n.p,{children:"The terminal output will be similar to that from our first script except with several key differences:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Updated manifest reference"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Since we've updated the manifest, we now have a new manifest reference:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"Updated manifest reference: aaec0f55d6e9216944246f5adce0834c69b55ac2164ea1f5777dadf545b8f3bc\n\nUpdated manifest URL: http://localhost:1633/bzz/aaec0f55d6e9216944246f5adce0834c69b55ac2164ea1f5777dadf545b8f3bc/\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Update ",(0,a.jsx)(n.code,{children:"SCRIPT_03_MANIFEST"})," in your ",(0,a.jsx)(n.code,{children:".env"})," file with the ",(0,a.jsx)(n.strong,{children:"Updated manifest reference"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"SCRIPT_03_MANIFEST=aaec0f55d6e9216944246f5adce0834c69b55ac2164ea1f5777dadf545b8f3bc\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Modified directory tree"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'"new.txt": {\n    "path": "new.txt",\n    "target": "0x3515db2f5e3c075b7546d7dd7dea1680c3e0785c6584e66b7e4f56fc344a0a78",\n    "metadata": {\n      "Content-Type": "text/plain; charset=utf-8",\n      "Filename": "new.txt"\n    },\n    "forks": {}\n  }\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Now if we navigate to ",(0,a.jsx)(n.a,{href:"http://localhost:1633/bzz/aaec0f55d6e9216944246f5adce0834c69b55ac2164ea1f5777dadf545b8f3bc/new.txt",children:"http://localhost:1633/bzz/aaec0f55d6e9216944246f5adce0834c69b55ac2164ea1f5777dadf545b8f3bc/new.txt"}),", we will see the contents of the new file added to our manifest:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"Hi, I'm new here.\n"})}),"\n",(0,a.jsx)(n.h3,{id:"explanation",children:"Explanation"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Load the existing manifest returned from the first script:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const node = await MantarayNode.unmarshal(bee, ROOT_MANIFEST)\nawait node.loadRecursively(bee)\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Upload a new file we intend to add to the manifest (not a directory):"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const { reference } = await bee.uploadData(batchId, bytes)\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"Insert the file into the manifest:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"node.addFork(filename, reference, metadata)\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsx)(n.li,{children:"Save the updated manifest:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const updated = await node.saveRecursively(bee, batchId)\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This produces a ",(0,a.jsx)(n.strong,{children:"new manifest reference"})," where the file is now accessible by path, for example:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"swarm-cli download aaec0f55d6e9216944246f5adce0834c69b55ac2164ea1f5777dadf545b8f3bc/new.txt ./\nnew.txt OK\n"})}),"\n",(0,a.jsx)(n.p,{children:"Print file contents to confirm:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"cat .\\new.txt\nHi, I'm new here.\n"})}),"\n",(0,a.jsx)(n.p,{children:"Our new file is now accessible through the same manifest reference along with all our other files."}),"\n",(0,a.jsx)(n.h2,{id:"script-3-moving-a-file-by-updating-the-manifest",children:"Script 3: Moving a File by Updating the Manifest"}),"\n",(0,a.jsx)(n.p,{children:"The third script shows how to move a file by modifying paths in the manifest."}),"\n",(0,a.jsx)(n.p,{children:"Full script:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/ethersphere/examples/blob/main/filesystem/script-03.js",children:(0,a.jsx)(n.code,{children:"script-03.js"})})}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["Before running the third script, make sure that you have updated your ",(0,a.jsx)(n.code,{children:".env"})," variable ",(0,a.jsx)(n.code,{children:"SCRIPT_03_MANIFEST"})," with the manifest reference returned by the second script (see terminal output from ",(0,a.jsx)(n.code,{children:"Updated manifest reference:"}),")."]})}),"\n",(0,a.jsx)(n.p,{children:"Full script:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/ethersphere/examples/blob/main/manifests/directory/script-03.js",children:(0,a.jsx)(n.code,{children:"script-03.js"})})}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"This is done by:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Locating the existing file entry"}),"\n",(0,a.jsx)(n.li,{children:"Removing it from its current path"}),"\n",(0,a.jsx)(n.li,{children:"Re-adding it under a new path"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Run the script:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"node script-03.js\n"})}),"\n",(0,a.jsx)(n.p,{children:"The output should look familiar, but again with several key changes:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Updated manifest reference"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Since we've made another change to the manifest, we have a new manifest reference:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"Updated manifest reference: 9a4a6305c811b2976498ef38270fffeb16966fc8719f745a4b18598d39e77ae0\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Modified directory tree"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["We no longer see the entry for ",(0,a.jsx)(n.code,{children:"new.txt"})," at the root directory, and we now have a new entry for the same file but now at an updated path in a nested directory:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'"nested/deeper/new.txt": {\n  "path": "nested/deeper/new.txt",\n  "target": "0x3515db2f5e3c075b7546d7dd7dea1680c3e0785c6584e66b7e4f56fc344a0a78",\n  "metadata": {\n    "Content-Type": "text/plain; charset=utf-8",\n    "Filename": "new.txt"\n  },\n  "forks": {}\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["If we navigate to the ",(0,a.jsx)(n.code,{children:"new.txt"})," file in its old location:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"http://localhost:1633/bzz/9a4a6305c811b2976498ef38270fffeb16966fc8719f745a4b18598d39e77ae0/new.txt",children:"http://localhost:1633/bzz/9a4a6305c811b2976498ef38270fffeb16966fc8719f745a4b18598d39e77ae0/new.txt"})}),"\n",(0,a.jsx)(n.p,{children:"We will get a 404 error since we removed that entry from the manifest."}),"\n",(0,a.jsxs)(n.p,{children:["But if we navigate to its new location at ",(0,a.jsx)(n.code,{children:"/nested/deeper/new.txt"})," we will now see it again:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"http://localhost:1633/bzz/9a4a6305c811b2976498ef38270fffeb16966fc8719f745a4b18598d39e77ae0/nested/deeper/new.txt",children:"http://localhost:1633/bzz/9a4a6305c811b2976498ef38270fffeb16966fc8719f745a4b18598d39e77ae0/nested/deeper/new.txt"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"Hi, I'm new here.\n"})}),"\n",(0,a.jsx)(n.h3,{id:"explanation-1",children:"Explanation"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Remove entry"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Remove the entry for ",(0,a.jsx)(n.code,{children:"new.txt"})," which was added by the second script:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'node.removeFork("new.txt")\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Add new entry"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Add a new entry for ",(0,a.jsx)(n.code,{children:"new.txt"})," in a new location in a nested directory:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'node.addFork(\n  "nested/deeper/new.txt",\n  fileRef,\n  metadata\n)\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"Save and print"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"const updated = await node.saveRecursively(bee, batchId);\nconst newManifestRef = updated.reference.toHex();\n"})}),"\n",(0,a.jsx)(n.p,{children:"After saving the manifest again, the file becomes accessible at:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"/nested/deeper/new.txt\n"})}),"\n",(0,a.jsxs)(n.p,{children:["No data is duplicated, the ",(0,a.jsx)(n.code,{children:"new.txt"})," file has not been modified, only the path mapping changes in the manifest."]}),"\n",(0,a.jsx)(n.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Uploading a directory creates a manifest"}),"\n",(0,a.jsx)(n.li,{children:"Files are accessed via the manifest, not directly by their internal references"}),"\n",(0,a.jsx)(n.li,{children:"Manifests can be modified to add, move, or remove files"}),"\n",(0,a.jsx)(n.li,{children:"Updating a manifest produces a new reference, but underlying data remains immutable"}),"\n",(0,a.jsx)(n.li,{children:"This provides filesystem-like behavior without mutable storage"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"With these tools, you can treat Swarm directories much like a filesystem \u2014 while still preserving immutability and content addressing."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}}}]);