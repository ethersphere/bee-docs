(self.webpackChunkbee_docs=self.webpackChunkbee_docs||[]).push([[2339],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return u},kt:function(){return d}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=l(a),d=o,m=p["".concat(c,".").concat(d)]||p[d]||h[d]||r;return a?n.createElement(m,s(s({ref:t},u),{},{components:a})):n.createElement(m,s({ref:t},u))}));function d(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,s=new Array(r);s[0]=p;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var l=2;l<r;l++)s[l]=a[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},1117:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return i},metadata:function(){return c},toc:function(){return l},default:function(){return h}});var n=a(2122),o=a(9756),r=(a(7294),a(3905)),s=["components"],i={title:"Cashing Out",id:"cashing-out"},c={unversionedId:"working-with-bee/cashing-out",id:"working-with-bee/cashing-out",isDocsHomePage:!1,title:"Cashing Out",description:"As your Bee forwards and serves chunks to its peers, it is rewarded in",source:"@site/docs/working-with-bee/cashing-out.md",sourceDirName:"working-with-bee",slug:"/working-with-bee/cashing-out",permalink:"/docs/working-with-bee/cashing-out",editUrl:"https://github.com/ethersphere/docs.github.io/blob/master/docs/working-with-bee/cashing-out.md",version:"current",frontMatter:{title:"Cashing Out",id:"cashing-out"},sidebar:"Balls",previous:{title:"Bee Tools",permalink:"/docs/working-with-bee/bee-tools"},next:{title:"Monitoring Your Node",permalink:"/docs/working-with-bee/monitoring"}},l=[],u={toc:l};function h(e){var t=e.components,a=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"As your Bee forwards and serves chunks to its peers, it is rewarded in\nBZZ in the form of cheques. Once these cheques accumulate sufficient\nvalue, you may ",(0,r.kt)("em",{parentName:"p"},"cash them out")," using Bee's API. This process transfers\nmoney from your peer's chequebooks into your own, which you can then\nwithdrawal to your wallet to do with as you please!"),(0,r.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Do ",(0,r.kt)("strong",{parentName:"p"},"not")," cash out your cheques too regularly! Once a week is more\nthan sufficient! Besides the transaction costs, this prevents and\nrelieves unneccesary congestion on the blockchain. \ud83d\udca9"))),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Learn more about how SWAP and other accounting protocols work by reading"),(0,r.kt)("a",{href:"/the-book-of-swarm.pdf",target:"_blank",rel:"noopener noreferrer"},"The Book of Swarm")," .")),(0,r.kt)("p",null,"Bee contains a rich set of features to enable you to query the current accounting state of your node. First, let's query our node's current balance by sending a POST request to the balances endpoint."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl localhost:1635/chequebook/balance | jq\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "totalBalance": "10000000",\n  "availableBalance": "9640360"\n}\n')),(0,r.kt)("p",null,"It is also possible to examine your per-peer balances."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl localhost:1635/balances | jq\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "balances": [\n    //...\n    {\n      "peer": "d0bf001e05014fa036af97f3d226bee253d2b147f540b6c2210947e5b7b409af",\n      "balance": "-85420"\n    },\n    {\n      "peer": "f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47",\n      "balance": "-75990"\n    }\n    //...\n  ]\n}\n')),(0,r.kt)("p",null,"In Swarm, these per-peer balances represent trustful agreements between nodes. Tokens only actually change hands when a node settles a cheque. This can either be triggered manually or when a certain threshold is reached with a peer. In this case, a settlement takes place. You may view these using the settlements endpoint."),(0,r.kt)("p",null,"More info can be found by using the chequebook API."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl localhost:1635/settlements| jq\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "totalreceived": "718030",\n  "totalsent": "0",\n  "settlements": [\n    //...\n    {\n      "peer": "dce1833609db868e7611145b48224c061ea57fd14e784a278f2469f355292ca6",\n      "received": "8987000000000",\n      "sent": "0"\n    }\n    //...\n  ]\n}\n')),(0,r.kt)("p",null,"More information about the current received or sent cheques can also be found using the chequebook api."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl localhost:1635/chequebook/cheque | jq\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "lastcheques": [\n    {\n      "peer": "dce1833609db868e7611145b48224c061ea57fd14e784a278f2469f355292ca6",\n      "lastreceived": {\n        "beneficiary": "0x21b26864067deb88e2d5cdca512167815f2910d3",\n        "chequebook": "0x4A373Db93ba54cab999e2C757bF5ca0356B42a3f",\n        "payout": "8987000000000"\n      },\n      "lastsent": null\n    }\n    //...\n  ]\n}\n')),(0,r.kt)("p",null,"As our node's participation in the network increases, we will begin to see more and more of these balances arriving. In the case that we have ",(0,r.kt)("em",{parentName:"p"},"received")," a settlement from another peer, we can ask our node to perform the relevant transactions on the blockchain, and cash our earnings out."),(0,r.kt)("p",null,"To do this, we simply POST the relevant peer's address to the ",(0,r.kt)("inlineCode",{parentName:"p"},"cashout")," endpoint."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl -XPOST http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "transactionHash": "0xba7b500e21fc0dc0d7163c13bb5fea235d4eb769d342e9c007f51ab8512a9a82"\n}\n')),(0,r.kt)("p",null,"You may check the status of your transaction using the ",(0,r.kt)("a",{parentName:"p",href:"https://blockscout.com/xdai/mainnet"},"XDAI\nBlockscout"),"."),(0,r.kt)("p",null,"Finally, we can now see the status of the cashout transaction by sending a GET request to the same URL."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b | jq\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "peer": "d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b",\n  "chequebook": "0xae315a9adf0920ba4f3353e2f011031ca701d247",\n  "cumulativePayout": "179160",\n  "beneficiary": "0x21b26864067deb88e2d5cdca512167815f2910d3",\n  "transactionHash": "0xba7b500e21fc0dc0d7163c13bb5fea235d4eb769d342e9c007f51ab8512a9a82",\n  "result": {\n    "recipient": "0x312fe7fde9e0768337c9b3e3462189ea6f9f9066",\n    "lastPayout": "179160",\n    "bounced": false\n  }\n}\n')),(0,r.kt)("p",null,"Success, we earned our first BZZ! \ud83d\udc1d"),(0,r.kt)("p",null,"Now we have earnt tokens, to withdraw our BZZ from the chequebook contract back into our node's own wallet, we simply POST a request to the chequebook withdraw endpoint."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl -XPOST http://localhost:1635/chequebook/withdraw\\?amount\\=1000 | jq\n")),(0,r.kt)("p",null,"And conversely, if we have used more services than we have provided, we may deposit extra BZZ into the chequebook contract by sending a POST request to the deposit endpoint."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl -XPOST http://localhost:1635/chequebook/deposit\\?amount\\=1000 | jq\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "transactionHash": "0xedc80ebc89e6d719e617a50c6900c3dd5dc2f283e1b8c447b9065d7c8280484a"\n}\n')),(0,r.kt)("p",null,"You may then use ",(0,r.kt)("a",{parentName:"p",href:"https://blockscout.com/xdai/mainnet"},"Blockscout")," to\ntrack your transaction and make sure it completed successfully."),(0,r.kt)("h1",{id:"managing-uncashed-cheques"},"Managing uncashed cheques"),(0,r.kt)("p",null,"For the Bee process, the final step of earning BZZ is cashing a\ncheque. It is worth noting that a cheque is not yet actual BZZs. In\nBee, a cheque, just like a real cheque, is a promise to hand over\nmoney upon request. In real life, you would present the cheque to a\nbank. In swarm life, we present the cheque to a smart-contract."),(0,r.kt)("p",null,"Holding on to a swap-cheque is risky; it is possible that the owner of\nthe chequebook has issued cheques worth more BZZ than is contained in\ntheir chequebook contract. For this reason, it is important to cash\nout your cheques every so often."),(0,r.kt)("p",null,"With the set of API endpoints, as offered by Bee, it is possible to\ndevelop a script that fully manages the uncashed cheques for you. As\nan example, we offer you a ",(0,r.kt)("a",{parentName:"p",href:"https://gist.github.com/ralph-pichler/3b5ccd7a5c5cd0500e6428752b37e975#file-cashout-sh"},"very basic\nscript"),",\nwhere you can manually cash out all cheques with a worth above a\ncertain value. To use the script:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Download and save the script:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"wget -O cashout.sh https://gist.githubusercontent.com/ralph-pichler/3b5ccd7a5c5cd0500e6428752b37e975/raw/cashout.sh\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Make the file executable:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"chmod +x cashout.sh\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"List all uncashed cheques and cash out your cheques above a certain value:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"List:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./cashout.sh\n")),(0,r.kt)("div",{parentName:"li",className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If running ./cashout.sh returns nothing, you currently have no uncashed cheques.")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Cashout all cheques:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./cashout.sh cashout-all\n")))),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Are you a Windows-user who is willing to help us? We are currently\nmissing a simple cashout script for Windows. Please see the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ethersphere/bee/issues/1092"},"issue"),"."))),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the officially deployed smart-contract by the Swarm team\nin the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ethersphere/swap-swear-and-swindle"},"swap-swear-and-swindle\nrepository"),"."))))}h.isMDXComponent=!0}}]);