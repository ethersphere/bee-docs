"use strict";(self.webpackChunkbee_docs=self.webpackChunkbee_docs||[]).push([[1628],{13249:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"bee/working-with-bee/staking","title":"Staking","description":"Quickstart Guide","source":"@site/docs/bee/working-with-bee/staking.md","sourceDirName":"bee/working-with-bee","slug":"/bee/working-with-bee/staking","permalink":"/docs/bee/working-with-bee/staking","draft":false,"unlisted":false,"editUrl":"https://github.com/ethersphere/docs.github.io/blob/master/docs/bee/working-with-bee/staking.md","tags":[],"version":"current","frontMatter":{"title":"Staking","id":"staking"},"sidebar":"bee","previous":{"title":"Swarm CLI","permalink":"/docs/bee/working-with-bee/swarm-cli"},"next":{"title":"Cashing Out","permalink":"/docs/bee/working-with-bee/cashing-out"}}');var t=s(74848),r=s(28453);const o={title:"Staking",id:"staking"},a=void 0,d={},c=[{value:"Quickstart Guide",id:"quickstart-guide",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Step 1: Fund Your Node with xDAI and xBZZ",id:"step-1-fund-your-node-with-xdai-and-xbzz",level:3},{value:"Step 2: Stake xBZZ",id:"step-2-stake-xbzz",level:3},{value:"Step 3: Check Status",id:"step-3-check-status",level:3},{value:"Step 4: Monitor &amp; Maximize Rewards",id:"step-4-monitor--maximize-rewards",level:3},{value:"Staking Overview",id:"staking-overview",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Check Status",id:"check-status",level:3},{value:"Partial Stake Withdrawals",id:"partial-stake-withdrawals",level:2},{value:"Check for withdrawable stake",id:"check-for-withdrawable-stake",level:3},{value:"Withdraw available stake",id:"withdraw-available-stake",level:3},{value:"Reserve Doubling",id:"reserve-doubling",level:2},{value:"Step by Step Guide",id:"step-by-step-guide",level:3},{value:"<strong>Step 1</strong>: Set <code>reserve-capacity-doubling</code> to <code>1</code>.",id:"step-1-set-reserve-capacity-doubling-to-1",level:4},{value:"<strong>Step 2</strong>: Stake at least 20 xBZZ",id:"step-2-stake-at-least-20-xbzz",level:4},{value:"<strong>Step 3</strong>: Restart node",id:"step-3-restart-node",level:4},{value:"Reserve Doubling Reversing &amp; Withdrawable Stake",id:"reserve-doubling-reversing--withdrawable-stake",level:3},{value:"How to free up withdrawable stake from a node with &gt;= 20 xBZZ stake that currently has zero withdrawable stake:",id:"how-to-free-up-withdrawable-stake-from-a-node-with--20-xbzz-stake-that-currently-has-zero-withdrawable-stake",level:4},{value:"Maximize rewards",id:"maximize-rewards",level:2},{value:"Neighborhood selection",id:"neighborhood-selection",level:3},{value:"Stake density",id:"stake-density",level:3},{value:"Neighborhood Hopping",id:"neighborhood-hopping",level:2},{value:"Checking neighborhood population",id:"checking-neighborhood-population",level:3},{value:"Stake Migration",id:"stake-migration",level:2},{value:"Step 1: Withdraw xBZZ",id:"step-1-withdraw-xbzz",level:3},{value:"Step 2: Stop node",id:"step-2-stop-node",level:3},{value:"Step 3: Update and restart",id:"step-3-update-and-restart",level:3},{value:"Step 4: Re-stake xBZZ",id:"step-4-re-stake-xbzz",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Frozen node",id:"frozen-node",level:3},{value:"Check frozen status",id:"check-frozen-status",level:4},{value:"Diagnosing freezing issues",id:"diagnosing-freezing-issues",level:4},{value:"Repairing corrupt reserve",id:"repairing-corrupt-reserve",level:3},{value:"Node occupies unusually large space on disk",id:"node-occupies-unusually-large-space-on-disk",level:3},{value:"Node not participating in redistribution",id:"node-not-participating-in-redistribution",level:3},{value:"Run sampler process to benchmark performance",id:"run-sampler-process-to-benchmark-performance",level:4}];function h(e){const n={a:"a",admonition:"admonition",annotation:"annotation",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",math:"math",mdxAdmonitionTitle:"mdxAdmonitionTitle",mn:"mn",mo:"mo",mrow:"mrow",msup:"msup",mtext:"mtext",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"quickstart-guide",children:"Quickstart Guide"}),"\n",(0,t.jsxs)(n.p,{children:["This guide will walk you through ",(0,t.jsx)(n.strong,{children:"staking xBZZ"})," and participating in the ",(0,t.jsx)(n.strong,{children:"redistribution game"})," to earn storage incentives."]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["Staking requires a fully synced full node and a minimum of 10 xBZZ. See detailed ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/staking#requirements",children:"staking requirements"})," below."]})}),"\n",(0,t.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A small amount of xDAI to pay transaction fees - ~0.01 xDAI is enough to start"}),"\n",(0,t.jsx)(n.li,{children:"At least 10 xBZZ to deposit as non-refundable stake"}),"\n",(0,t.jsx)(n.li,{children:"A fully synced full Bee node"}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["If you don't already have xDAI or xBZZ, you will need to ",(0,t.jsx)(n.a,{href:"/docs/bee/installation/fund-your-node#getting-tokens",children:"get some"}),"."]})}),"\n",(0,t.jsx)(n.h3,{id:"step-1-fund-your-node-with-xdai-and-xbzz",children:"Step 1: Fund Your Node with xDAI and xBZZ"}),"\n",(0,t.jsxs)(n.p,{children:["Your node needs ",(0,t.jsx)(n.strong,{children:"xDAI"})," to pay for transaction fees on Gnosis Chain, and also needs ",(0,t.jsx)(n.strong,{children:"xBZZ"})," to deposit as stake."]}),"\n",(0,t.jsx)(n.p,{children:"First, find your node's address using:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"swarm-cli addresses\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This will print your node's various addresses. The one you need to fund is ",(0,t.jsx)(n.code,{children:"Ethereum"})]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"Ethereum"})," term here refers to an Ethereum style address on Gnosis Chain. Do not send funds to the address on the Ethereum chain itself."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"Node Addresses\n------------------------------------------------------------------------------------------------------------------\nEthereum: 9a73f283cd9211b96b5ec63f7a81a0ddc847cd93\n...\n"})}),"\n",(0,t.jsx)(n.p,{children:"Then, use the following command to check how much is required:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"swarm-cli status\n"})}),"\n",(0,t.jsxs)(n.p,{children:["At the bottom of the results printed to the terminal you will find the ",(0,t.jsx)(n.code,{children:"Redistribution"})," section. From there you will see the ",(0,t.jsx)(n.code,{children:"Minimum gas funds"})," item. That value is the minimum amount required to participate in a ",(0,t.jsx)(n.em,{children:"single redistribution round"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["If you plan on operating your node for an extended period, you will want to deposit quite a bit more than the minimum. You can start with ",(0,t.jsx)(n.strong,{children:"0.01 xDAI"})," to cover fees for the next few weeks/months of active staking, and then monitor actual usage and top-up when needed."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Redistribution\nReward: 0.0000000000000000\nHas sufficient funds: true\nFully synced: true\nFrozen: false\nLast selected round: 263526\nLast played round: 0\nLast won round: 0\nMinimum gas funds: 0.000000000326250000\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Finally, send the required xDAI and xBZZ to the address you got from ",(0,t.jsx)(n.code,{children:"swarm-cli addresses"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"You will need to send at least 10 xBZZ to get started staking."}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Send ",(0,t.jsx)(n.strong,{children:"20 xBZZ"})," if using the ",(0,t.jsx)(n.a,{href:"#reserve-doubling",children:"reserve doubling"})," feature."]})}),"\n",(0,t.jsx)(n.h3,{id:"step-2-stake-xbzz",children:"Step 2: Stake xBZZ"}),"\n",(0,t.jsxs)(n.p,{children:["Once your node has xDAI, stake ",(0,t.jsx)(n.strong,{children:"at least 10 xBZZ"})," (this is non-refundable)."]}),"\n",(0,t.jsxs)(n.p,{children:["You can use the following ",(0,t.jsx)(n.code,{children:"swarm-cli"})," command to stake 10 xBZZ:"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["The deposit amount is specified in ",(0,t.jsx)(n.a,{href:"/docs/references/glossary/#plur",children:"PLUR"})]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"swarm-cli stake --deposit 100000000000000000\n"})}),"\n",(0,t.jsx)(n.p,{children:"After a moment, the staking transaction will complete. Then you can check that the transaction was successful:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"swarm-cli stake\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"Staked xBZZ: 10\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Optional:"})," Stake ",(0,t.jsx)(n.strong,{children:"20 xBZZ"})," if using the ",(0,t.jsx)(n.a,{href:"#reserve-doubling",children:"reserve doubling"})," feature."]})}),"\n",(0,t.jsx)(n.h3,{id:"step-3-check-status",children:"Step 3: Check Status"}),"\n",(0,t.jsxs)(n.p,{children:["After staking you should ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/staking#check-status",children:"check your node's status"})," to make sure it is fully synced, fully funded, and operating properly."]}),"\n",(0,t.jsx)(n.h3,{id:"step-4-monitor--maximize-rewards",children:"Step 4: Monitor & Maximize Rewards"}),"\n",(0,t.jsxs)(n.p,{children:["\u2705 Make sure you are using a stable Gnosis Chain ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/configuration#setting-blockchain-rpc-endpoint",children:"RPC endpoint"}),".",(0,t.jsx)(n.br,{}),"\n","\u2705 ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/staking#check-redistribution-status",children:"Check your node's status"})," to ensure it's operating properly.\n\u2705 ",(0,t.jsxs)(n.a,{href:"/docs/bee/working-with-bee/bee-api#rchash",children:["Check ",(0,t.jsx)(n.code,{children:"/rchash"})]})," to ensure your node's performance is sufficient."]}),"\n",(0,t.jsx)(n.h2,{id:"staking-overview",children:"Staking Overview"}),"\n",(0,t.jsxs)(n.p,{children:["To earn storage incentives by participating in the ",(0,t.jsx)(n.a,{href:"/docs/concepts/incentives/redistribution-game",children:"redistribution game"}),", full nodes must first deposit a minimum of 10 xBZZ as ",(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"non-refundable"})})," stake. xDAI is also required to pay for ongoing Gnosis Chain transactions related to the redistribution game."]}),"\n",(0,t.jsx)(n.admonition,{type:"danger",children:(0,t.jsx)(n.p,{children:"Only stake your xBZZ if you intend to participate as a full node, as withdrawals are not possible."})}),"\n",(0,t.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/node-types",children:"full node"})," - see full node ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/node-types#recommended-specifications",children:"recommend specs"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/configuration#setting-blockchain-rpc-endpoint",children:"high-performance RPC endpoint"})," connection to Gnosis Chain."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["A minimum of 10 xBZZ to be used as ",(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"non-refundable"})})," stake (the requirement is increased if ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/staking#reserve-doubling",children:"reserve doubling"})," is used)."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"check-status",children:"Check Status"}),"\n",(0,t.jsxs)(n.p,{children:["Use the ",(0,t.jsx)("a",{href:"/api/#tag/RedistributionState",target:"_blank",rel:"noopener noreferrer",children:(0,t.jsx)(n.code,{children:"/redistributionstate"})})," endpoint of the API to get more information about the redistribution status of the node."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -X GET http://localhost:1633/redistributionstate | jq\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{ \n  "minimumFunds": "18750000000000000",\n  "hasSufficientFunds": true,\n  "isFrozen": false,\n  "isFullySynced": true,\n  "phase": "commit",\n  "round": 176319,\n  "lastWonRound": 176024,\n  "lastPlayedRound": 176182,\n  "lastFrozenRound": 0,\n  "block": 26800488,\n  "reward": "10479124611072000",\n  "fees": "30166618102500000"\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"minimumFunds": <integer>'})," - The minimum xDAI needed to play a single round of the redistribution game (the unit is 1e-18 xDAI)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"hasSufficientFunds": <bool>'})," - Shows whether the node has enough xDAI balance to submit at least five storage incentives redistribution related transactions.  If ",(0,t.jsx)(n.code,{children:"false"})," the node will not be permitted to participate in next round."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"isFrozen": <bool>'})," - Shows node frozen status."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"isFullySynced": <bool>'})," - Shows whether node's localstore has completed full historical syncing with all connected peers."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"phase": <string>'})," - Current phase of ",(0,t.jsx)(n.a,{href:"/docs/concepts/incentives/redistribution-game",children:"redistribution game"})," (",(0,t.jsx)(n.code,{children:"commit"}),", ",(0,t.jsx)(n.code,{children:"reveal"}),", or ",(0,t.jsx)(n.code,{children:"claim"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"round": <integer>'}),' - Current round of redistribution game. The round number is determined by dividing the current Gnosis Chain block height by the number of blocks in one round. One round takes 152 blocks, so using the "block" output from the example above we can confirm that the round number is 176319 (block 26800488 / 152 blocks = round 176319).']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"lastWonRound": <integer>'})," - Number of round last won by this node."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"lastPlayedRound": <integer>'})," - Number of the last round where node's neighborhood was selected to participate in redistribution game."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"lastFrozenRound": <integer>'})," The number the round when node was last frozen."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"block": <integer>'})," - Gnosis block of the current redistribution game."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"reward": <string (BigInt)>'})," - Record of total reward received in ",(0,t.jsx)(n.a,{href:"/docs/references/glossary#plur",children:"PLUR"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'"fees": <string (BigInt)>'})," - Record of total spent in 1E-18 xDAI on all redistribution related transactions."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["Do not shut down or update your node during an active redistribution round as it may cause them to lose out on winnings or become frozen. To see if your node is playing the current round, check if ",(0,t.jsx)(n.code,{children:"lastPlayedRound"})," equals ",(0,t.jsx)(n.code,{children:"round"})," in the output from the ",(0,t.jsxs)(n.a,{href:"/api/#tag/RedistributionState/paths/~1redistributionstate/get",children:[(0,t.jsx)(n.code,{children:"/redistributionstate"})," endpoint"]}),"."]})}),"\n",(0,t.jsxs)(n.p,{children:["You should also check the ",(0,t.jsx)(n.a,{href:"/api/#tag/Node-Status/paths/~1status/get",children:(0,t.jsx)(n.code,{children:"/status"})})," endpoint:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -s  http://localhost:1633/status | jq\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{\n  "peer": "da7e5cc3ed9a46b6e7491d3bf738535d98112641380cbed2e9ddfe4cf4fc01c4",\n  "proximity": 0,\n  "beeMode": "full",\n  "reserveSize": 3747532,\n  "pullsyncRate": 0,\n  "storageRadius": 10,\n  "connectedPeers": 183,\n  "neighborhoodSize": 12,\n  "batchCommitment": 133828050944,\n  "isReachable": true\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Expected values for a healthy staking node:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:'"beeMode": full'})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:'"pullsyncRate": 0'})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:'"isReachable": true'})}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["If your node is not operating properly such as getting frozen or not participating in any rounds, see the ",(0,t.jsx)(n.a,{href:"#troubleshooting",children:"troubleshooting section"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"partial-stake-withdrawals",children:"Partial Stake Withdrawals"}),"\n",(0,t.jsx)(n.p,{children:"If the price of xBZZ rises significantly and provides excess collateral, a partial withdrawal will be allowed down to the minimum required stake:"}),"\n",(0,t.jsx)(n.h3,{id:"check-for-withdrawable-stake",children:"Check for withdrawable stake"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:1633/stake/withdrawable | jq\n"})}),"\n",(0,t.jsx)(n.p,{children:"If there is any stake available for withdrawal, the amount will be displayed in PLUR:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{\n  "withdrawableStake": "18411"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"withdraw-available-stake",children:"Withdraw available stake"}),"\n",(0,t.jsxs)(n.p,{children:["If there is any stake available for withdrawal, you can withdraw it using the ",(0,t.jsx)(n.code,{children:"DELETE"})," method on ",(0,t.jsx)(n.code,{children:"/stake/withdrawable"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -X DELETE http://localhost:1633/stake/withdrawable\n"})}),"\n",(0,t.jsx)(n.h2,{id:"reserve-doubling",children:"Reserve Doubling"}),"\n",(0,t.jsx)(n.p,{children:'The reserve doubling feature enables nodes to store chunks from a neighboring "sister" area, effectively increasing their reserve capacity twofold. By maintaining chunks from this sister neighborhood, a node becomes eligible to join the redistribution game whenever the sister neighborhood is chosen, effectively doubling its chances of participating.'}),"\n",(0,t.jsx)(n.p,{children:"Although reserve doubling demands twice the disk storage and increases bandwidth usage for chunk syncing (with no additional bandwidth needed for chunk forwarding), its effect on CPU and RAM consumption remains minimal. This feature provides node operators with greater flexibility to optimize their nodes, aiming to achieve a higher reward-to-resource usage ratio."}),"\n",(0,t.jsx)(n.h3,{id:"step-by-step-guide",children:"Step by Step Guide"}),"\n",(0,t.jsxs)(n.p,{children:["In order to double a node's reserve which has previously been operating without doubling, the ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," option must be updated from the default of ",(0,t.jsx)(n.code,{children:"0"})," to ",(0,t.jsx)(n.code,{children:"1"})," and restarted. There is also an increase in the xBZZ stake requirement from the minimum of 10 xBZZ to 20 xBZZ."]}),"\n",(0,t.jsxs)(n.h4,{id:"step-1-set-reserve-capacity-doubling-to-1",children:[(0,t.jsx)(n.strong,{children:"Step 1"}),": Set ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," to ",(0,t.jsx)(n.code,{children:"1"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The reserve doubling feature can be enabled by setting the new ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," config option to ",(0,t.jsx)(n.code,{children:"1"}),"  using the ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/configuration#configuration-methods-and-priority",children:"configuration method"})," of your choice."]}),"\n",(0,t.jsxs)(n.h4,{id:"step-2-stake-at-least-20-xbzz",children:[(0,t.jsx)(n.strong,{children:"Step 2"}),": Stake at least 20 xBZZ"]}),"\n",(0,t.jsx)(n.p,{children:"For doubling the reserve of a node which was previously operating which already has 10 xBZZ staked, simply stake an additional 10 xBZZ for a total of 20 xBZZ stake:"}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"As always, ensure you properly convert the stake parameter to PLUR, where 1 PLUR equals 1e-16 xBZZ."})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -X POST localhost:1633/stake/100000000000000000\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or for a new node with zero staked xBZZ, the entire 20 xBZZ can be staked at once:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -X POST localhost:1633/stake/200000000000000000\n"})}),"\n",(0,t.jsxs)(n.p,{children:["We can use the ",(0,t.jsx)(n.code,{children:"GET /stake"})," endpoint to confirm the total stake for our node:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -s  http://localhost:1633/stake | jq\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{\n  "stakedAmount": "200000000000000000"\n}\n'})}),"\n",(0,t.jsxs)(n.h4,{id:"step-3-restart-node",children:[(0,t.jsx)(n.strong,{children:"Step 3"}),": Restart node"]}),"\n",(0,t.jsxs)(n.p,{children:["After ensuring the node has at least 20 xBZZ staked and the ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," option has been set to ",(0,t.jsx)(n.code,{children:"1"}),", restart the node."]}),"\n",(0,t.jsx)(n.p,{children:"After restarting your node, it should then begin syncing chunks from its sister neighborhood."}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"/status/neighborhoods"})," endpoint can be used to confirm that the node has doubled its reserve and is now syncing with its sister neighborhood:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{\n  "neighborhoods": [\n    {\n      "neighborhood": "01111101011",\n      "reserveSizeWithinRadius": 1148351,\n      "proximity": 10\n    },\n    {\n      "neighborhood": "01111101010",\n      "reserveSizeWithinRadius": 1147423,\n      "proximity": 11\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"The output should list both your original and sister neighborhood."}),"\n",(0,t.jsxs)(n.p,{children:["We can also check the ",(0,t.jsx)(n.code,{children:"/status"})," endpoint to confirm our node is syncing new chunks:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -s  http://localhost:1633/status | jq\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{\n  "overlay": "be177e61b13b1caa20690311a909bd674a3c1ef5f00d60414f261856a8ad5c30",\n  "proximity": 256,\n  "beeMode": "full",\n  "reserveSize": 4192792,\n  "reserveSizeWithinRadius": 2295023,\n  "pullsyncRate": 1.3033333333333332,\n  "storageRadius": 10,\n  "connectedPeers": 18,\n  "neighborhoodSize": 1,\n  "batchCommitment": 388104192,\n  "isReachable": true,\n  "lastSyncedBlock": 6982430\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["We can see that the ",(0,t.jsx)(n.code,{children:"pullsyncRate"})," value is above zero, meaning that our node is currently syncing chunks, as expected."]}),"\n",(0,t.jsx)(n.h3,{id:"reserve-doubling-reversing--withdrawable-stake",children:"Reserve Doubling Reversing & Withdrawable Stake"}),"\n",(0,t.jsxs)(n.p,{children:["Due to certain ",(0,t.jsx)(n.a,{href:"https://github.com/ethersphere/storage-incentives/blob/20bf3c0e3fcf1e98dedcbf16cd82fb4d337fdaf7/src/Staking.sol#L136",children:"implementation details"}),", the order in which a node's reserve is doubled and then reversed can have an impact on the amount of withdrawable stake."]}),"\n",(0,t.jsxs)(n.p,{children:["When doubling a node's reserve, stake should be added AFTER\nsetting ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," to 1. If instead, xBZZ is first staked with ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," set to 0, and the reserve is then doubled by increasing from 0 to 1 without the addition of more stake, this will prevent stake from being withdrawable when the doubling is reversed."]}),"\n",(0,t.jsx)(n.p,{children:"In order to maximize the amount of withdrawable stake after reversing a reserve doubling, follow the step from the previous section in the exact order described when doubling."}),"\n",(0,t.jsx)(n.h4,{id:"how-to-free-up-withdrawable-stake-from-a-node-with--20-xbzz-stake-that-currently-has-zero-withdrawable-stake",children:"How to free up withdrawable stake from a node with >= 20 xBZZ stake that currently has zero withdrawable stake:"}),"\n",(0,t.jsxs)(n.p,{children:["In the case that a node with 20 xBZZ stake was doubled directly by increasing ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," from 0 to 1, the surplus xBZZ over the minimum required 10 xBZZ cannot be made withdrawable by simply reversing the ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," from 1 back to 0."]}),"\n",(0,t.jsxs)(n.p,{children:["In this case, you will need to first send a minimal staking transaction of 1 PLUR while ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," is set to 1, and after that, change ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," from 1 to 0. This works because every time any amount of stake is added, it forces to staking contract to redo its calculations."]}),"\n",(0,t.jsx)(n.p,{children:"The detailed steps are:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Issue a staking transaction for 1 PLUR while ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," is set to 1.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -X POST localhost:1633/stake/1\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Stop node and set ",(0,t.jsx)(n.code,{children:"reserve-capacity-doubling"})," to 0."]}),"\n",(0,t.jsx)(n.li,{children:"Restart node. The 10 xBZZ should now be withdrawable."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"maximize-rewards",children:"Maximize rewards"}),"\n",(0,t.jsxs)(n.p,{children:["There are two main factors which determine the chances for a staking node to win a reward \u2014 neighborhood selection and stake density. Both of these should be considered together before starting up a Bee node for the first time. See the ",(0,t.jsx)(n.a,{href:"/docs/concepts/incentives/redistribution-game",children:"incentives page"})," for more context."]}),"\n",(0,t.jsx)(n.h3,{id:"neighborhood-selection",children:"Neighborhood selection"}),"\n",(0,t.jsxs)(n.p,{children:["By default when running a Bee node for the first time the node will use the ",(0,t.jsx)(n.a,{href:"https://api.swarmscan.io/v1/network/neighborhoods/suggestion",children:"neighborhood suggestion tool"})," from Swarmscan to find an optimal ",(0,t.jsx)(n.a,{href:"/docs/concepts/DISC/neighborhoods",children:"neighborhood"}),". While it is possible to manually choose a neighborhood using the ",(0,t.jsx)(n.code,{children:"target-neighborhood"})," config option, we recommend not to do so as the suggestion tool will pick neighborhoods in order to maximize node earnings and network health. ",(0,t.jsx)(n.a,{href:"/docs/bee/installation/set-target-neighborhood",children:"Learn more"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"stake-density",children:"Stake density"}),"\n",(0,t.jsx)(n.p,{children:"Stake density is defined as:"}),"\n",(0,t.jsx)(n.span,{className:"katex-display",children:(0,t.jsxs)(n.span,{className:"katex",children:[(0,t.jsx)(n.span,{className:"katex-mathml",children:(0,t.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,t.jsxs)(n.semantics,{children:[(0,t.jsxs)(n.mrow,{children:[(0,t.jsx)(n.mtext,{children:"stake\xa0density"}),(0,t.jsx)(n.mo,{children:"="}),(0,t.jsx)(n.mtext,{children:"staked\xa0xBZZ"}),(0,t.jsx)(n.mo,{children:"\xd7"}),(0,t.jsxs)(n.msup,{children:[(0,t.jsx)(n.mn,{children:"2"}),(0,t.jsx)(n.mtext,{children:"storageDepth"})]})]}),(0,t.jsx)(n.annotation,{encoding:"application/x-tex",children:"\\text{stake density} = \\text{staked xBZZ} \\times {2}^\\text{storageDepth}"})]})})}),(0,t.jsxs)(n.span,{className:"katex-html","aria-hidden":"true",children:[(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(n.span,{className:"mord text",children:(0,t.jsx)(n.span,{className:"mord",children:"stake\xa0density"})}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(n.span,{className:"mrel",children:"="}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.7778em",verticalAlign:"-0.0833em"}}),(0,t.jsx)(n.span,{className:"mord text",children:(0,t.jsx)(n.span,{className:"mord",children:"staked\xa0xBZZ"})}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(n.span,{className:"mbin",children:"\xd7"}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.8991em"}}),(0,t.jsxs)(n.span,{className:"mord",children:[(0,t.jsx)(n.span,{className:"mord",children:(0,t.jsx)(n.span,{className:"mord",children:"2"})}),(0,t.jsx)(n.span,{className:"msupsub",children:(0,t.jsx)(n.span,{className:"vlist-t",children:(0,t.jsx)(n.span,{className:"vlist-r",children:(0,t.jsx)(n.span,{className:"vlist",style:{height:"0.8991em"},children:(0,t.jsxs)(n.span,{style:{top:"-3.113em",marginRight:"0.05em"},children:[(0,t.jsx)(n.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(n.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(n.span,{className:"mord text mtight",children:(0,t.jsx)(n.span,{className:"mord mtight",children:"storageDepth"})})})]})})})})})]})]})]})]})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.em,{children:["To learn more about stake density and the mechanics of the incentives system, see the ",(0,t.jsx)(n.a,{href:"/docs/concepts/incentives/redistribution-game",children:"incentives page"}),"."]})}),"\n",(0,t.jsx)(n.p,{children:"Stake density determines the weighted chances of nodes within a neighborhood of winning rewards. The chance of winning within a neighborhood corresponds to stake density. Stake density can be increased by depositing more xBZZ as stake (note that stake withdrawals are not currently possible, so any staked xBZZ is not currently recoverable)."}),"\n",(0,t.jsxs)(n.p,{children:["Generally speaking, the minimum required stake of 10 xBZZ is sufficient, and rewards can be better maximized by operating more nodes over a greater range of neighborhoods rather than increasing stake. However this may not be true for all node operators depending on how many different neighborhoods they operate nodes in, and it also may change as network dynamics continue to evolve (join the ",(0,t.jsx)(n.code,{children:"#node-operators"})," ",(0,t.jsx)(n.a,{href:"https://discord.com/channels/799027393297514537/811553590170353685",children:"Discord channel"})," to stay up to date with the latest discussions about staking and network dynamics)."]}),"\n",(0,t.jsx)(n.h2,{id:"neighborhood-hopping",children:"Neighborhood Hopping"}),"\n",(0,t.jsxs)(n.admonition,{type:"warning",children:[(0,t.jsx)(n.mdxAdmonitionTitle,{}),(0,t.jsx)(n.p,{children:"There is a 2 round delay (with 152 Gnosis Chain blocks per redistribution game round) every time a node's neighborhood or stake is changed before it can participate in the redistribution game, moreover a node must fully sync the chunks from its new neighborhood before it can participate in the redistribution game, so hopping too frequently is not advised."})]}),"\n",(0,t.jsxs)(n.p,{children:["You can use the config option ",(0,t.jsx)(n.code,{children:"target-neighborhood"})," to switch your node over to a new neighborhood. You may wish to use this option if your node's neighborhood becomes overpopulated."]}),"\n",(0,t.jsx)(n.h3,{id:"checking-neighborhood-population",children:"Checking neighborhood population"}),"\n",(0,t.jsxs)(n.p,{children:["For a quick check of your node's neighborhood population, we can use the ",(0,t.jsx)(n.code,{children:"/status"})," endpoint:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -s http://localhost:1633/status | jq\n{\n  "peer": "e7b5c1aac67693268fdec98d097a8ccee1aabcf58e26c4512ea888256d0e6dff",\n  "proximity": 0,\n  "beeMode": "full",\n  "reserveSize": 1055543,\n  "reserveSizeWithinRadius": 1039749,\n  "pullsyncRate": 42.67013868148148,\n  "storageRadius": 11,\n  "connectedPeers": 140,\n  "neighborhoodSize": 6,\n  "batchCommitment": 74463051776,\n  "isReachable": false\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Here we can see that at the current ",(0,t.jsx)(n.code,{children:"storageRadius"})," of 11, our node is in a neighborhood with size 6 from the ",(0,t.jsx)(n.code,{children:"neighborhoodSize"})," value."]}),"\n",(0,t.jsxs)(n.p,{children:["Using the ",(0,t.jsx)(n.a,{href:"https://swarmscan.io/neighborhoods",children:"Swarmscan neighborhoods tool"})," we can see there are many neighborhoods with fewer nodes, so it would benefit us to move to less populated neighborhood:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:s(81920).A+"",width:"2102",height:"1224"})}),"\n",(0,t.jsx)(n.p,{children:"While you might be tempted to simply pick one of these less populated neighborhoods, it is best practice to use the neighborhood suggester API instead, since it will help to prevent too many node operators rapidly moving to the same underpopulated neighborhoods, and also since the suggester takes a look at the next depth down to make sure that even in case of a neighborhood split, your node will end up in the smaller neighborhood."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -s https://api.swarmscan.io/v1/network/neighborhoods/suggestion\n"})}),"\n",(0,t.jsx)(n.p,{children:"Copy the binary number returned from the API:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{"neighborhood":"01100011110"}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Use the binary number you just copied and set it as a string value for the ",(0,t.jsx)(n.code,{children:"target-neighborhood"})," option in your config."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'## bee.yaml\ntarget-neighborhood: "01100011110"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"stake-migration",children:"Stake Migration"}),"\n",(0,t.jsx)(n.p,{children:"If a new Bee release includes an updated staking contract, then you will be required to migrate your node's stake in order to continue normal operation. The stake migration process consists of the following steps:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Withdraw xBZZ"}),"\n",(0,t.jsx)(n.li,{children:"Stop node"}),"\n",(0,t.jsx)(n.li,{children:"Update and restart"}),"\n",(0,t.jsx)(n.li,{children:"Re-stake to the new contract"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"step-1-withdraw-xbzz",children:"Step 1: Withdraw xBZZ"}),"\n",(0,t.jsx)(n.p,{children:"When a new version of Bee is released with an updated staking contract, the previous staking contract will be disabled, and stake withdrawals will be enabled."}),"\n",(0,t.jsxs)(n.p,{children:["Once the contract is disabled, stake can be withdrawn by calling the ",(0,t.jsx)(n.code,{children:"/stake"})," endpoint with the ",(0,t.jsx)(n.code,{children:"DELETE"})," method:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -X DELETE http://localhost:1633/stake\n"})}),"\n",(0,t.jsx)(n.p,{children:"This command will withdraw all stake from the node to the node\u2019s Gnosis Chain address."}),"\n",(0,t.jsx)(n.p,{children:"Confirm that the stake was withdrawn:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:" curl -s  http://localhost:1633/stake | jq\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The value for ",(0,t.jsx)(n.code,{children:"stakedAmount"})," should now be zero:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'{\n  "stakedAmount": "0"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"step-2-stop-node",children:"Step 2: Stop node"}),"\n",(0,t.jsx)(n.p,{children:"This step will vary depending on how the node was set up:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo systemctl stop bee\n"})}),"\n",(0,t.jsx)(n.p,{children:"or"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"docker compose down\n"})}),"\n",(0,t.jsx)(n.p,{children:"or"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"docker stop <container_name_or_id>\n"})}),"\n",(0,t.jsx)(n.p,{children:"etc."}),"\n",(0,t.jsx)(n.h3,{id:"step-3-update-and-restart",children:"Step 3: Update and restart"}),"\n",(0,t.jsx)(n.admonition,{type:"danger",children:(0,t.jsxs)(n.p,{children:["Before every Bee client upgrade, it is best practice to ALWAYS take a full ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/backups",children:"backup"})," of your node."]})}),"\n",(0,t.jsx)(n.p,{children:"After withdrawing stake and stopping the node, update to the newest version of Bee. After updating, restart the node."}),"\n",(0,t.jsxs)(n.p,{children:["You can use the ",(0,t.jsx)(n.code,{children:"/health"})," endpoint to confirm your current Bee version:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -s http://localhost:1633/health | jq\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To confirm a successful update, check that the value for the ",(0,t.jsx)(n.code,{children:'"version"'})," field in the results corresponds to the version number of the ",(0,t.jsx)(n.a,{href:"https://github.com/ethersphere/bee/releases/latest",children:"latest"})," Bee release."]}),"\n",(0,t.jsx)(n.p,{children:"For example, if the latest version was 2.6.0, it would look like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{\n  "status": "ok",\n  "version": "2.6.0-d0aa8b93",\n  "apiVersion": "7.3.0"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.em,{children:["Make sure to check the ",(0,t.jsx)(n.a,{href:"https://github.com/ethersphere/bee/releases/latest",children:"latest"})," version number yourself, as the versions shown in examples in this guide may not always be up to date with the latest."]})}),"\n",(0,t.jsx)(n.h3,{id:"step-4-re-stake-xbzz",children:"Step 4: Re-stake xBZZ"}),"\n",(0,t.jsx)(n.p,{children:"After upgrading to the latest version and restarting, xBZZ should be re-staked into the new staking contract so that the node can continue to participate in the redistribution game."}),"\n",(0,t.jsx)(n.p,{children:"To stake the minimum required 10 xBZZ:"}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Make sure to modify to the correct staking amount in case your node is using ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/staking#reserve-doubling",children:"reserve doubling"}),"."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -X POST localhost:1633/stake/100000000000000000\n"})}),"\n",(0,t.jsx)(n.p,{children:"Confirm that the staking transaction was successful:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -s  http://localhost:1633/stake | jq\n"})}),"\n",(0,t.jsx)(n.p,{children:"The expected output after staking the minimum of 10 xBZZ:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{\n  "stakedAmount": "100000000000000000"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Congratulations! You have performed a successful stake migration and your node will now continue to operate as normal."}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsxs)(n.p,{children:["In this section we cover several commonly seen issues encountered for staking nodes participating in the redistribution game. If you don't see your issue covered here or require additional guidance, check out the ",(0,t.jsx)(n.code,{children:"#node-operators"})," ",(0,t.jsx)(n.a,{href:"https://discord.com/channels/799027393297514537/811553590170353685",children:"Discord channel"})," where you will find support from other node operators and community members."]}),"\n",(0,t.jsx)(n.h3,{id:"frozen-node",children:"Frozen node"}),"\n",(0,t.jsxs)(n.p,{children:["A node will be frozen when the reserve commitment hash it submits in its ",(0,t.jsxs)(n.a,{href:"/docs/concepts/incentives/redistribution-game",children:[(0,t.jsx)(n.code,{children:"commit"})," transaction"]})," does not match the correct hash. The reserve commitment hash is used as proof that a node is storing the chunks it is responsible for. It will not be able to play in the redistribution game during the freezing period. See the  ",(0,t.jsx)(n.a,{href:"/docs/concepts/incentives/redistribution-game",children:"penalties"})," section for more information."]}),"\n",(0,t.jsx)(n.h4,{id:"check-frozen-status",children:"Check frozen status"}),"\n",(0,t.jsxs)(n.p,{children:["You can check your node's frozen status using the ",(0,t.jsx)(n.code,{children:"/redistributionstate"})," endpoint:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -X GET http://localhost:1633/redistributionstate | jq\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{ \n  "minimumFunds": "18750000000000000",\n  "hasSufficientFunds": true,\n  "isFrozen": false,\n  "isFullySynced": true,\n  "phase": "commit",\n  "round": 176319,\n  "lastWonRound": 176024,\n  "lastPlayedRound": 176182,\n  "lastFrozenRound": 0,\n  "block": 26800488,\n  "reward": "10479124611072000",\n  "fees": "30166618102500000"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The relevant fields here are ",(0,t.jsx)(n.code,{children:"isFrozen"})," and ",(0,t.jsx)(n.code,{children:"lastFrozenRound"}),", which respectively indicate whether the node is currently frozen and the last round in which the node was frozen."]}),"\n",(0,t.jsx)(n.h4,{id:"diagnosing-freezing-issues",children:"Diagnosing freezing issues"}),"\n",(0,t.jsxs)(n.p,{children:["In order to diagnose the cause of freezing issues we must compare our own node's status to that of other nodes within the same neighborhood by comparing the results from our own node returned from the ",(0,t.jsx)(n.code,{children:"/status"})," endpoint to the other nodes in the same neighborhood which can be found from the ",(0,t.jsx)(n.code,{children:"/status/peers"})," endpoint."]}),"\n",(0,t.jsx)(n.p,{children:"First we check our own node's status:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:" curl -s localhost:1633/status | jq\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'  {\n    "peer": "da7e5cc3ed9a46b6e7491d3bf738535d98112641380cbed2e9ddfe4cf4fc01c4",\n    "proximity": 0,\n    "beeMode": "full",\n    "reserveSize": 3747532,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 183,\n    "neighborhoodSize": 12,\n    "batchCommitment": 133828050944,\n    "isReachable": true \n  }\n'})}),"\n",(0,t.jsx)(n.p,{children:"And next we will find the status for all the other nodes in the same neighborhood as our own."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:" curl -s  localhost:1633/status/peers | jq\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"/status/peers"})," endpoint returns all the peers of our node, but we are only concerned with peers in the same neighborhood as our own node. Nodes whose ",(0,t.jsx)(n.code,{children:"proximity"})," value is equal to or greater than our own node's ",(0,t.jsx)(n.code,{children:"storageRadius"})," value all fall into the same neighborhood as our node, so the rest have been omitted in the example output below:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{ \n  ...\n   {\n    "peer": "da33f7a504a74094242d3e542475b49847d1d0f375e0c86bac1c9d7f0937acc0",\n    "proximity": 9,\n    "beeMode": "full",\n    "reserveSize": 3782924,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 188,\n    "neighborhoodSize": 11,\n    "batchCommitment": 133828050944,\n    "isReachable": true\n  },\n  {\n    "peer": "da4b529cc1aedc62e31849cf7f8ab8c1866d9d86038b857d6cf2f590604387fe",\n    "proximity": 10,\n    "beeMode": "full",\n    "reserveSize": 3719593,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 176,\n    "neighborhoodSize": 11,\n    "batchCommitment": 133828050944,\n    "isReachable": true\n  },\n  {\n    "peer": "da5d39a5508fadf66c8665d5e51617f0e9e5fd501e429c38471b861f104c1504",\n    "proximity": 10,\n    "beeMode": "full",\n    "reserveSize": 3777241,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 198,\n    "neighborhoodSize": 12,\n    "batchCommitment": 133828050944,\n    "isReachable": true\n  },\n  {\n    "peer": "da4cb0d125bba638def55c0061b00d7c01ed4033fa193d6e53a67183c5488d73",\n    "proximity": 10,\n    "beeMode": "full",\n    "reserveSize": 3849125,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 181,\n    "neighborhoodSize": 13,\n    "batchCommitment": 133828050944,\n    "isReachable": true\n  },\n  {\n    "peer": "da4b1cd5d15e061fdd474003b5602ab1cff939b4b9e30d60f8ff693141ede810",\n    "proximity": 10,\n    "beeMode": "full",\n    "reserveSize": 3778452,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 183,\n    "neighborhoodSize": 12,\n    "batchCommitment": 133827002368,\n    "isReachable": true\n  },\n  {\n    "peer": "da49e6c6174e3410edad2e0f05d704bbc33e9996bc0ead310d55372677316593",\n    "proximity": 10,\n    "beeMode": "full",\n    "reserveSize": 3779560,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 185,\n    "neighborhoodSize": 12,\n    "batchCommitment": 133828050944,\n    "isReachable": true\n  },\n  {\n    "peer": "da4cdab480f323d5791d3ab8d22d99147f110841e44a8991a169f0ab1f47d8e5",\n    "proximity": 10,\n    "beeMode": "full",\n    "reserveSize": 3778518,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 189,\n    "neighborhoodSize": 11,\n    "batchCommitment": 133828050944,\n    "isReachable": true\n  },\n  {\n    "peer": "da4ccec79bc34b502c802415b0008c4cee161faf3cee0f572bb019b117c89b2f",\n    "proximity": 10,\n    "beeMode": "full",\n    "reserveSize": 3779003,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 179,\n    "neighborhoodSize": 10,\n    "batchCommitment": 133828050944,\n    "isReachable": true\n  },\n  {\n    "peer": "da69d412b79358f84b7928d2f6b7ccdaf165a21313608e16edd317a5355ba250",\n    "proximity": 11,\n    "beeMode": "full",\n    "reserveSize": 3712586,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 189,\n    "neighborhoodSize": 12,\n    "batchCommitment": 133827002368,\n    "isReachable": true\n  },\n  {\n    "peer": "da61967b1bd614a69e5e83f73cc98a63a70ebe20454ca9aafea6b57493e00a34",\n    "proximity": 11,\n    "beeMode": "full",\n    "reserveSize": 3780190,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 182,\n    "neighborhoodSize": 13,\n    "batchCommitment": 133828050944,\n    "isReachable": true\n  },\n  {\n    "peer": "da7b6a268637cfd6799a9923129347fc3d564496ea79aea119e89c09c5d9efed",\n    "proximity": 13,\n    "beeMode": "full",\n    "reserveSize": 3721494,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 188,\n    "neighborhoodSize": 14,\n    "batchCommitment": 133828050944,\n    "isReachable": true\n  },\n  {\n    "peer": "da7a974149543df1b459831286b42b302f22393a20e9b3dd9a7bb5a7aa5af263",\n    "proximity": 13,\n    "beeMode": "full",\n    "reserveSize": 3852986,\n    "pullsyncRate": 0,\n    "storageRadius": 10,\n    "connectedPeers": 186,\n    "neighborhoodSize": 12,\n    "batchCommitment": 133828050944,\n    "isReachable": true\n  }\n]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Now that we have the status for our own node and all its neighborhood peers we can begin to diagnose the issue through a series of checks outlined below:"}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"If you are able to identify and fix a problem with your node from the checklist below, it's possible that your node's reserve has become corrupted. Therefore, after fixing the problem, stop your node, and repair your node according to the instructions in the section following the checklist."})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Compare ",(0,t.jsx)(n.code,{children:"reserveSize"})," with peers"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"reserveSize"})," value is the number of chunks stored by a node in its reserve. The value for ",(0,t.jsx)(n.code,{children:"reserveSize"})," for a healthy node should be around +/- 1% the size of most other nodes in the neighborhood. In our example, for our node's ",(0,t.jsx)(n.code,{children:"reserveSize"})," of 3747532, it falls within that normal range. This does not guarantee our node has no missing or corrupted chunks, but it does indicate that it is generally storing the same chunks as its neighbors. If it falls outside this range, see the next section for instructions on repairing reserves."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Compare ",(0,t.jsx)(n.code,{children:"batchCommitment"})," with peers"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"batchCommitment"})," value shows how many chunks would be stored if all postage batches were fully utilised. It also represents whether the node has fully synced postage batch data from on-chain. If your node's ",(0,t.jsx)(n.code,{children:"batchCommitment"})," value falls below that of its peers in the same neighborhood, it could indicate an issue with your blockchain RPC endpoint that is preventing it from properly syncing on-chain data. If you are running your own node, check your setup to make sure it is functioning properly, or check with your provider if you are using a 3rd party service for your RPC endpoint."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Check ",(0,t.jsx)(n.code,{children:"pullsyncRate"})]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"pullsyncRate"})," value measures the speed at which a node is syncing chunks from its peers. Once a node is fully synced, ",(0,t.jsx)(n.code,{children:"pullsyncRate"})," should go to zero. If ",(0,t.jsx)(n.code,{children:"pullsyncRate"})," is above zero it indicates that your node is still syncing chunks, so you should wait until it goes to zero before doing any other checks. If ",(0,t.jsx)(n.code,{children:"pullsyncRate"})," is at zero but your node's ",(0,t.jsx)(n.code,{children:"reserveSize"})," does not match its peers, you should check whether your network connection and RPC endpoint are stable and functioning properly. A node should be fully synced after several hours at most."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Check most recent ",(0,t.jsx)(n.code,{children:"block"})," number"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"block"})," value returned from the ",(0,t.jsx)(n.code,{children:"/redistributionstate"})," endpoint shows the most recent block a node has synced. If this number is far behind the actual more recent block then it indicates an issue with your RPC endpoint or network. If you are running your own node, check your setup to make sure it is functioning properly, or check with your provider if you are using a 3rd party service for your RPC endpoint."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -X GET http://localhost:1633/redistributionstate | jq\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{ \n  "minimumFunds": "18750000000000000",\n  "hasSufficientFunds": true,\n  "isFrozen": false,\n  "isFullySynced": true,\n  "phase": "commit",\n  "round": 176319,\n  "lastWonRound": 176024,\n  "lastPlayedRound": 176182,\n  "lastFrozenRound": 0,\n  "block": 26800488,\n  "reward": "10479124611072000",\n  "fees": "30166618102500000"\n}\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Check peer connectivity"}),"\n",(0,t.jsxs)(n.p,{children:["Compare the value of your node's ",(0,t.jsx)(n.code,{children:"neighborhoodSize"})," from the ",(0,t.jsx)(n.code,{children:"/status"})," endpoint and the ",(0,t.jsx)(n.code,{children:"neighborhoodSize"})," of its peers in the same neighborhood from the ",(0,t.jsx)(n.code,{children:"/status/peers"})," endpoint. The figure should be generally the same (although it may fluctuate slightly up or down at any one point in time). If your node's ",(0,t.jsx)(n.code,{children:"neighborhoodSize"})," value is significantly different and remains so over time then your node likely has a connectivity problem. Make sure to ",(0,t.jsx)(n.a,{href:"/docs/bee/installation/connectivity",children:"check your network environment"})," to ensure your node is able to communicate with the network."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"If no problems are identified during these checks it likely indicates that your node was frozen in error and there are no additional steps you need to take."}),"\n",(0,t.jsx)(n.h3,{id:"repairing-corrupt-reserve",children:"Repairing corrupt reserve"}),"\n",(0,t.jsxs)(n.p,{children:["If you have identified and fixed a problem causing your node to become frozen or have other reason to believe that your node's reserves are corrupted then you should repair your node's reserve using the ",(0,t.jsx)(n.code,{children:"db repair-reserve"})," command."]}),"\n",(0,t.jsx)(n.p,{children:"First stop your node, and then run the following command:"}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.p,{children:["Make sure to replace ",(0,t.jsx)(n.code,{children:"/home/bee/.bee"})," with your node\u2019s data directory if it differs from the one shown in the example. Make sure that the directory you specify is the root directory for your node\u2019s data files, not the localstore directory itself. This is the same directory specified using the ",(0,t.jsx)(n.code,{children:"data-dir"})," option in your node\u2019s ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/configuration/",children:"configuration"}),"."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"bee db repair-reserve --data-dir=/home/bee/.bee\n"})}),"\n",(0,t.jsx)(n.p,{children:"After the command has finished running, you may restart your node."}),"\n",(0,t.jsx)(n.h3,{id:"node-occupies-unusually-large-space-on-disk",children:"Node occupies unusually large space on disk"}),"\n",(0,t.jsxs)(n.p,{children:["During normal operation of a Bee node, it should not take up more than ~30 GB of disk space. In the rare cases when the node's occupied disk space grows larger, you may need to use the compaction ",(0,t.jsx)(n.code,{children:"db compact"})," command."]}),"\n",(0,t.jsx)(n.admonition,{type:"danger",children:(0,t.jsx)(n.p,{children:"To prevent any data loss, operators should run the compaction on a copy of the localstore directory and, if successful, replace the original localstore with the compacted copy."})}),"\n",(0,t.jsxs)(n.p,{children:["The command is available as a sub-command under db as such (make sure to replace the value for ",(0,t.jsx)(n.code,{children:"--data-dir"})," with the correct path to your bee node's data folder if it differs from the path shown in the example):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"bee db compact --data-dir=/home/bee/.bee\n"})}),"\n",(0,t.jsx)(n.h3,{id:"node-not-participating-in-redistribution",children:"Node not participating in redistribution"}),"\n",(0,t.jsxs)(n.p,{children:["First check that the node is fully synced, is not frozen, and has sufficient funds to participate in staking. To check node sync status, call the ",(0,t.jsx)(n.code,{children:"redistributionstate"})," endpoint:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"curl -X GET http://localhost:1633/redistributionstate | jq\n"})}),"\n",(0,t.jsx)(n.p,{children:"Response:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'{ \n  "minimumFunds": "18750000000000000",\n  "hasSufficientFunds": true,\n  "isFrozen": false,\n  "isFullySynced": true,\n  "phase": "commit",\n  "round": 176319,\n  "lastWonRound": 176024,\n  "lastPlayedRound": 176182,\n  "lastFrozenRound": 0,\n  "block": 26800488,\n  "reward": "10479124611072000",\n  "fees": "30166618102500000"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Confirm that ",(0,t.jsx)(n.code,{children:"hasSufficientFunds"})," is ",(0,t.jsx)(n.code,{children:"true"}),", and ",(0,t.jsx)(n.code,{children:"isFullySynced"})," is ",(0,t.jsx)(n.code,{children:"true"})," before moving to the next step. If ",(0,t.jsx)(n.code,{children:"hasSufficientFunds"})," is ",(0,t.jsx)(n.code,{children:"false"}),", make sure to add at least the amount of xDAI shown in ",(0,t.jsx)(n.code,{children:"minimumFunds"})," (unit of 1e-18 xDAI). If the node was recently installed and ",(0,t.jsx)(n.code,{children:"isFullySynced"})," is ",(0,t.jsx)(n.code,{children:"false"}),", wait for the node to fully sync before continuing. After confirming the node's status, continue to the next step."]}),"\n",(0,t.jsx)(n.h4,{id:"run-sampler-process-to-benchmark-performance",children:"Run sampler process to benchmark performance"}),"\n",(0,t.jsxs)(n.p,{children:["One of the most common issues affecting staking is the ",(0,t.jsx)(n.code,{children:"sampler"})," process failing. The sampler is a resource intensive process which is run by nodes which are selected to take part in redistribution. The process may fail or time out if the node's hardware specifications aren't high enough. To check a node's performance the ",(0,t.jsx)(n.code,{children:"/rchash"})," endpoint of the API may be used. See the ",(0,t.jsx)(n.code,{children:"/rchash"})," section of the ",(0,t.jsx)(n.a,{href:"/docs/bee/working-with-bee/bee-api/",children:"Bee API page for usage details"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["If you are still experiencing problems, you can find more help in the ",(0,t.jsx)(n.a,{href:"https://discord.gg/kHRyMNpw7t",children:"node-operators"})," Discord channel (for your safety, do not accept advice from anyone sending a private message on Discord)."]})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(96540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},81920:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/staking-swarmscan-7a08f2c5be1d57dbe9c9b64f8fb3c608.png"}}]);