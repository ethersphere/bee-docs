<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-develop/contribute/protocols" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Protocols | Swarm Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.ethswarm.org/docs/develop/contribute/protocols"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Protocols | Swarm Documentation"><meta data-rh="true" name="description" content="Protocols specifications"><meta data-rh="true" property="og:description" content="Protocols specifications"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.ethswarm.org/docs/develop/contribute/protocols"><link data-rh="true" rel="alternate" href="https://docs.ethswarm.org/docs/develop/contribute/protocols" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.ethswarm.org/docs/develop/contribute/protocols" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UAJRQL15I8-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Swarm Documentation" href="/opensearch.xml">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/matomo.js" async></script><link rel="stylesheet" href="/assets/css/styles.5d6b39f3.css">
<script src="/assets/js/runtime~main.713860f1.js" defer="defer"></script>
<script src="/assets/js/main.fdfadcbb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Swarm Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Swarm Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link inter">Concepts</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/concepts/introduction">Introduction</a></li><li><a class="dropdown__link" href="/docs/concepts/what-is-swarm">What is Swarm?</a></li><li><a class="dropdown__link" href="/docs/concepts/DISC/">DISC Storage</a></li><li><a class="dropdown__link" href="/docs/concepts/incentives/overview">Incentives</a></li><li><a class="dropdown__link" href="/docs/concepts/pss">PSS</a></li><li><a class="dropdown__link" href="/docs/concepts/access-control">Access Control</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Bee Client</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/bee/installation/getting-started">Installation</a></li><li><a class="dropdown__link" href="/docs/bee/working-with-bee/introduction">Working With Bee</a></li><li><a class="dropdown__link" href="/docs/bee/bee-faq">Bee FAQ</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Develop</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/develop/introduction">Introduction</a></li><li><a class="dropdown__link" href="/docs/develop/access-the-swarm/introduction">Access the Swarm</a></li><li><a class="dropdown__link" href="/docs/develop/tools-and-features/introduction">Tools and Features</a></li><li><a class="dropdown__link" href="/docs/develop/contribute/introduction">Contribute to Bee Development</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Desktop App</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/desktop/introduction">Introduction</a></li><li><a class="dropdown__link" href="/docs/desktop/install">Install</a></li><li><a class="dropdown__link" href="/docs/desktop/configuration">Configuration</a></li><li><a class="dropdown__link" href="/docs/desktop/access-content">Access Content</a></li><li><a class="dropdown__link" href="/docs/desktop/postage-stamps">Postage Stamps</a></li><li><a class="dropdown__link" href="/docs/desktop/upload-content">Upload Content</a></li><li><a class="dropdown__link" href="/docs/desktop/backup-restore">Backup and Restore</a></li><li><a class="dropdown__link" href="/docs/desktop/publish-a-website">Publish a Static Website</a></li><li><a class="dropdown__link" href="/docs/desktop/start-a-blog">Start a Blog</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">References</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/references/smart-contracts">Smart Contracts</a></li><li><a class="dropdown__link" href="/docs/references/tokens">Tokens</a></li><li><a class="dropdown__link" href="/docs/references/community">Community</a></li><li><a class="dropdown__link" href="/docs/references/glossary">Glossary</a></li><li><a class="dropdown__link" href="/docs/references/fair-data-society">Fair Data Society</a></li><li><a class="dropdown__link" href="/docs/references/awesome-list">Awesome Swarm</a></li><li><a class="dropdown__link" href="/docs/references/faq">FAQ</a></li></ul></div><a class="navbar__item navbar__link" href="/api/">API Specification</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ethersphere/bee" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/develop/introduction">Develop</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/introduction">Introduction</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/develop/access-the-swarm/introduction">Access the Swarm</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/access-the-swarm/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/access-the-swarm/buy-a-stamp-batch">Buy a Batch of Stamps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/access-the-swarm/upload-and-download">Upload and Download</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/access-the-swarm/erasure-coding">Erasure Coding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/access-the-swarm/store-with-encryption">Store with Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/access-the-swarm/host-your-website">Host Your Website on Swarm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/access-the-swarm/syncing">Track Upload Status</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/access-the-swarm/pinning">Pinning</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/develop/tools-and-features/introduction">Tools and Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/tools-and-features/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/tools-and-features/bee-js">Bee JS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/tools-and-features/gateway-proxy">Gateway Proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/tools-and-features/chunk-types">Chunk Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/tools-and-features/feeds">Feeds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/tools-and-features/pss">PSS Messaging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/tools-and-features/gsoc">GSOC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/tools-and-features/bee-dev-mode">Developer mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/tools-and-features/starting-a-test-network">Starting a Private Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/tools-and-features/act">Access Control</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/develop/contribute/introduction">Contribute</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/contribute/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/develop/contribute/protocols">Protocols</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Contribute</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Protocols</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Protocols</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="protocols-specifications">Protocols specifications<a href="#protocols-specifications" class="hash-link" aria-label="Direct link to Protocols specifications" title="Direct link to Protocols specifications">​</a></h2>
<p>An attempt to describe the desired behaviour of the main DISC protocols, which corresponds to the rational choice a node should make in order to maximize its profitability.</p>
<p>A communications protocol is a set of formal rules describing how to transmit or exchange data, especially across a network.</p>
<p>We&#x27;ll begin by describing the Hive, Retrieval, PushSync, PullSync communication protocols as well as the Kademlia topology component.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proposal">Proposal<a href="#proposal" class="hash-link" aria-label="Direct link to Proposal" title="Direct link to Proposal">​</a></h2>
<p>The purpose of this document is to specify these concepts:</p>
<ul>
<li>A pattern of exchange of messages which in semantic units corresponds to the high level function of what a node accomplishes in an exchange.</li>
<li>Strategies of behaviour that a node should adopt in situations like network disconnects, timeouts, invalid chunks etc.</li>
<li>An incentivisation strategy such that constructive behaviour should be rewarded and encouraged while deviating from the protocol rules should result in punishing measures.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hive">Hive<a href="#hive" class="hash-link" aria-label="Direct link to Hive" title="Direct link to Hive">​</a></h2>
<p>The Hive protocol defines how nodes exchange information about their peers in order to reach and maintain a saturated Kademlia connectivity.</p>
<p>The exchange of this information happens upon connection, however nodes can broadcast newly received peers to their peers during the lifetime of connection.</p>
<p>While the simplest approach is to share all known peers (during an exchange) it might be more optimal to narrow down to a useful subset of peers - for instance all the peers up to a certain depth or belonging to a certain bin.</p>
<p>The exchanged information includes both overlay and underlay addresses of the known remote peers.</p>
<p>The overlay address serves to select peers to achieve the connectivity pattern needed for the desired network topology, while the underlay address is needed to establish the peer connections by dialing selected peers.</p>
<p>Upon receiving a peers message, nodes should store the peer information in their address book, i.e., a data structure containing info about peers known to the node that is meant to be persisted across sessions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="appendix">Appendix<a href="#appendix" class="hash-link" aria-label="Direct link to Appendix" title="Direct link to Appendix">​</a></h3>
<p>The protobuf definitions</p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Copyright 2020 The Swarm Authors. All rights reserved.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Use of this source code is governed by a BSD-style</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// license that can be found in the LICENSE file.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">package hive;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">option go_package = &quot;pb&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Peers {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    repeated BzzAddress peers = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message BzzAddress {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes Underlay = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes Signature = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes Overlay = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes Nonce = 4;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kademlia">Kademlia<a href="#kademlia" class="hash-link" aria-label="Direct link to Kademlia" title="Direct link to Kademlia">​</a></h2>
<p>Kademlia topology is a specific connectivity pattern used by all DISC protocols and its purpose is to route messages between nodes in a network using overlay addressing.</p>
<p>The message routing happens in such a fashion that with every network hop we will get closer to the target node, specifically at half of the distance covered by the previous hop.</p>
<p>Swarm uses the recursive/forwarding style of Kademlia.</p>
<p>This approach implies that every forwarding node - once it received a request - will keep an in-memory record that captures the request related information (requester, time of the request etc.) until the request is satisfied, rejected or times out.</p>
<p>Because a forwarder can not reliably tell how much time the downstream peer will need to satisfy the request - the choice of a reasonable value for waiting period is a point of contention.</p>
<p>It is constrained by these factors:</p>
<ul>
<li>keeping the in-memory record for too long means that there&#x27;s going to be a limit on how many concurrent requests a peer can keep &quot;in-flight&quot;, because memory is limited.</li>
<li>if the peer decides to time out prematurely (while downstream peers are still processing the request) then the effort of all the downstream peers will be wasted.</li>
<li>we should distinguish between unsolicited chunks and chunks that we received from the downstream after we stopped waiting for the response (timed out). After a certain period of time all responses will be treated the same because of the need to free the allocated resources (the in-memory record).</li>
</ul>
<p>Conversely the downstream should be informed when the upstream is no longer interested in the previously sent request, so it could free the used resources. This way the downstream won&#x27;t return the chunk after the request has timed out, risking being punished.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="push-and-pull-chunk-retrieval-and-syncing">Push and pull: chunk retrieval and syncing<a href="#push-and-pull-chunk-retrieval-and-syncing" class="hash-link" aria-label="Direct link to Push and pull: chunk retrieval and syncing" title="Direct link to Push and pull: chunk retrieval and syncing">​</a></h2>
<p>Swarm involves a direct storage scheme of fixed size where chunks are stored on nodes with address corresponding to the chunk address.</p>
<p>The syncing protocols act in such a way that they reach those neighborhoods whenever a request is initiated.</p>
<p>Such a route is sure to exist as a result of the Kademlia topology of keep-alive connections between peers.</p>
<p>The process of relaying the request from the initiator to the storer is called forwarding and also the process of passing the chunk data along the same path is called backwarding.</p>
<p>Conversely - Backwarding and Forwarding are both notions defined on a keep alive network of peers as strategies of reaching certain addresses.</p>
<p>If we zoom into a particular node in the forwarding (or backwarding) path we see the following strategy:</p>
<ul>
<li>Receive a request</li>
<li>Decide who to forward the request to (decision strategy)</li>
<li>Have a way to match the the response to the original request.</li>
</ul>
<p>The crucial step is the second one - strategy of choosing the peer to forward the request to and how they react to failure like stream closure or nodes dropping offline or closing the protocol connection and whether we proactively initiate several requests to peers.</p>
<p>The last step does not apply for the storer nodes, since they do not forward the request but they satisfy it.</p>
<p>The key element of these notions is that the decision about the next action is being done on the node level, which will select the next peers(s) and delegate them with handling the request.</p>
<p>The simplest representation of this would be a recursive algorithm that with every iteration gets closer to the target address and stops when it runs out of peers or successfully reaches the target node.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h3>
<ul>
<li>We need a way to determine the &quot;best&quot; candidate peer to forward the request to, and if this option fails, continue with the &quot;next-best&quot; candidate until we exhaust available peers. The decision of picking the &quot;best&quot; peer is delegate to an overlay driver that has the best knowledge of this peer&#x27;s past history and performance and topology structure.</li>
<li>We need a strategy of parallelisation of requests that we pass downstream, where appropriate. Parallel requests to different peers allow us increase the chances of successfully syncing the chunk but it comes with the cost of using our bandwidth allowance, so it&#x27;s imperative to zoom in on an optimal balance between the two.</li>
<li>We need a way to ensure that when we issue a syncing request we don’t end up in a situation when this request comes back around to us, wasting network resources.</li>
<li>In the case when we are a &quot;forwarder&quot; node, we might consider a decision strategy on whether we want to cache the chunk in the event of a repeated request.</li>
<li>To every forwarding/backwarding exchange we attach an incentivisation action that would take into account variables like the success of the action and the cost of performing the action.</li>
<li>We need to design the optimal incentivisation scheme, to determine the optimal payment/settlement frequency and correctness of computation of the payment/charged amount. This also applies to both chunk storage scheme and the relayed request-response scheme.</li>
<li>We need to have a sensible strategy when it comes to waiting for a peer to respond to our request; as a forwarder, we want to make our best effort to sync the chunk but without waiting for an excessive amount of time, which would lead to waste of resources.</li>
<li>When receiving a response to an expired request - or we are unable to conclude if such a request has ever been issued - punishing measures should be imposed on the upstream peer.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="incentivisation-strategy">Incentivisation strategy<a href="#incentivisation-strategy" class="hash-link" aria-label="Direct link to Incentivisation strategy" title="Direct link to Incentivisation strategy">​</a></h3>
<p>An incentivisation strategy should be put in place in such way that it encourages honest collaboration between nodes.</p>
<p>This implies that a given peer will make the best effort to satisfy any request while not allowing any abuse and waste of its resources.</p>
<p>Having an accounting component that would keep track of the exchange activity between peers ensures that we do not allow excessive freeloading from the misbehaving peers.</p>
<p>Having a granular punishment strategy ensures that the peers who misbehave (perhaps due to network latencies) will not be sanctioned to the same extent as peers who engage in grave protocol breaches, but are given a chance to &quot;clean up their act&quot;.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="retrieval">Retrieval<a href="#retrieval" class="hash-link" aria-label="Direct link to Retrieval" title="Direct link to Retrieval">​</a></h2>
<p>The retrieval of a chunk is a process which fetches a given chunk from the network by its address.</p>
<p>It follows the general semantics of the chunk syncing described above and follows the same network path as the push sync protocol, but in reverse.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="protocol-breach">Protocol breach<a href="#protocol-breach" class="hash-link" aria-label="Direct link to Protocol breach" title="Direct link to Protocol breach">​</a></h3>
<ul>
<li>Receiving a repeated request for a non-existent chunk should lead to rate limiting in order to discourage resource wasteful actions.</li>
<li>Receiving a response in the form of an invalid chunk constitutes a protocol breach and punishing measures are being taken against the peer at fault.</li>
</ul>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">step I</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1) check if this exact request has been received within last N minutes and it is for a non-existent chunk</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2) if such request is found - take punishing measures against the requester (blocklisting)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3) request a peer from Kademlia</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4) request chunk from the peer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">5) if the peer does not return a valid chunk - go back to step 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">6) if the chunk is found and valid, log the event details in the local state and return the chunk to the requester</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7) consider caching the chunk in case there might be a repeated request for it</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error states</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> if we exhaust the list of peers (candidates) for this action, return a &#x27;failure to get chunk&#x27; response to the requester. We might consider increasing our peer connections pool to avoid such situation in the future</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> if we are able to conclude that the chunk is non-existent (TBD) we return &#x27;chunk not found&#x27; and consider rate limiting measures against the requester.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> if we ran out of allowed time while looking for the chunk we return a &#x27;timeout&#x27; response to the requester</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> if the chunk is retrieved successfully but does not pass validation, take punishing measures against the peer (blocklisting).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> if the attempt fails, log the relevant attempt details in the local state and repeat the attempt against a new peer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> if the peer times out responding to our request we log the attempt details and repeat step II against a new peer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-chunk---sequence-diagram">Request chunk - sequence diagram<a href="#request-chunk---sequence-diagram" class="hash-link" aria-label="Direct link to Request chunk - sequence diagram" title="Direct link to Request chunk - sequence diagram">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-chunk---flow-diagram">Request chunk - flow diagram<a href="#request-chunk---flow-diagram" class="hash-link" aria-label="Direct link to Request chunk - flow diagram" title="Direct link to Request chunk - flow diagram">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="appendix-1">Appendix<a href="#appendix-1" class="hash-link" aria-label="Direct link to Appendix" title="Direct link to Appendix">​</a></h3>
<p>The protobuf definitions</p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Copyright 2020 The Swarm Authors. All rights reserved.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Use of this source code is governed by a BSD-style</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// license that can be found in the LICENSE file.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">package retrieval;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">option go_package = &quot;pb&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Request {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Addr = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Delivery {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Data = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Stamp = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pushsync">Pushsync<a href="#pushsync" class="hash-link" aria-label="Direct link to Pushsync" title="Direct link to Pushsync">​</a></h2>
<p>Pushsync protocol is responsible for ensuring delivery of the chunk to its prescribed storer after it has been uploaded to any arbitrary node.</p>
<p>It works in a similar way to the Retrieval protocol in the sense that the chunk is being passed to a peer whose address is closest to the chunk address and a custody receipt is received in response.</p>
<p>Then the same process is repeated until the chunk eventually reaches the storer node located in a certain &quot;neighborhood&quot;.</p>
<p>Since the Pushsync protocol is a &quot;mirror&quot; version of the Retrieval protocol - it ensures that a successfully uploaded chunk is retrievable from the same &quot;neighborhood&quot; by the virtue of the fact that nodes in a neighborhood are connected to each other.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multiplexing">Multiplexing<a href="#multiplexing" class="hash-link" aria-label="Direct link to Multiplexing" title="Direct link to Multiplexing">​</a></h3>
<p>Multiplexing is a recommended node strategy for the push sync protocol that involves early replication and opportunistic receipting. Its intention is to reduce the dependence on single closest nodes and to improve on network performance, i.e., push sync success rate, bandwidth overhead and latency.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a href="#context" class="hash-link" aria-label="Direct link to Context" title="Direct link to Context">​</a></h4>
<p>The current implementation of the push sync protocol aims to push a chunk to the closest node in the neighborhood which is then supposed to give out a receipt.</p>
<p>This is motivated by the  retrieval protocol that aims to find the chunk at this closest node.</p>
<p>When the closest node hands out a receipt, this node also replicates the chunk to 3 peers in the neighborhood which are further away from the chunk than him.</p>
<p>This replication takes place to ensure that the chunk is not lost when the closest node shuts down before the chunk is not pull-sync&#x27;ed and to speed up the spreading of the chunk in the neighborhood, in advance of pull sync.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="problem">Problem<a href="#problem" class="hash-link" aria-label="Direct link to Problem" title="Direct link to Problem">​</a></h4>
<p>Treating the closest node as a single target of push sync is fragile. If this peer has a badly-performing blockchain backend, slow or incomplete connectivity or is malicious, it may not spread the chunk and/or does not respond with a receipt.</p>
<p>In this case, currently, the originator must retry the entire push-sync operation many times before the other peers within neighborhood recognise the improper behaviour.</p>
<p>In-neighborhood retries are ideally avoided because such retries might cause the downstream timeouts to expire.</p>
<p>In case of incomplete connectivity, the push sync protocol can end at a different branch of the neighborhood than the retrieval protocol--causing the chunk not to be retrievable.</p>
<p>It should be noted that the pull sync protocol (may?) remedies this problem with a small time-delay.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="multiplexing-early-replication-within-neighborhood">Multiplexing: early replication within neighborhood<a href="#multiplexing-early-replication-within-neighborhood" class="hash-link" aria-label="Direct link to Multiplexing: early replication within neighborhood" title="Direct link to Multiplexing: early replication within neighborhood">​</a></h4>
<p>The first node in the push sync forward chain that falls within the neighborhood acts as <em>multiplexer</em>, i.e., it forwards the request to a number of closest nodes and responds with a self-signed receipt.</p>
<p>Thus in achieving retrievability and security via early replication, we do not critically rely on the closest node to be available any more.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="push-sync-flow">Push sync flow<a href="#push-sync-flow" class="hash-link" aria-label="Direct link to Push sync flow" title="Direct link to Push sync flow">​</a></h4>
<p>We define the different roles peers have as part of the push sync forwarding chain:</p>
<ul>
<li>originator -- creator of the request</li>
<li>forwarder -- closer to the chunk than the originator, further away away than the 1-before node.</li>
<li>multiplexer -- first node in the forward chain who is in the neighborhood</li>
<li>closest nodes -- according to the downstream node (usually the multiplexer), within the <code>n</code> closest nodes to the chunks (not including self)</li>
</ul>
<p>we describe the envisioned flow of push sync by describing the intended behaviour strategy of the various roles.</p>
<ol>
<li>originator sends chunk to a peer closer to the chunk.</li>
<li>forwarder(s) forwards chunk that ends up with a node already within the neighborhood that acts as multiplexer</li>
<li>The multiplexer concurrently sends the chunk to 3 closest nodes attaching a multiplexing-list as part of the protocol message. At the same time they respond to their upstream peer with a self-signed receipt (unless the multiplexer is itself the originator).</li>
<li>Non-multiplexing closest nodes, i.e., nodes in the neighborhood that receive the pushsync message from a not-closest neighbour with a multiplexing list included, validate whether, based on their view, the multiplexing list covers all 3 closest nodes (potentially including the peer and/or the upstream peer themselves). If not, the node forwards the chunk to the peers left out. These peers are also added to the multiplexing list received from upstream and the extended list is attached with the chunk pushed.</li>
</ol>
<p>If the multiplexer node does not know a closest peer <em>p</em> but several of its chosen closest nodes do, then that node <em>p</em> will receive the same pushsynced chunk multiple times</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="appendix-2">Appendix<a href="#appendix-2" class="hash-link" aria-label="Direct link to Appendix" title="Direct link to Appendix">​</a></h3>
<p>The protobuf definitions</p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Copyright 2020 The Swarm Authors. All rights reserved.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Use of this source code is governed by a BSD-style</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// license that can be found in the LICENSE file.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">package pushsync;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">option go_package = &quot;pb&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Delivery {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Address = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Data = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Stamp = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Receipt {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Address = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Signature = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Nonce = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pullsync">Pullsync<a href="#pullsync" class="hash-link" aria-label="Direct link to Pullsync" title="Direct link to Pullsync">​</a></h2>
<p>While the other described protocols are request scoped, Pullsync is a subscription type protocol.</p>
<p>It&#x27;s worth mentioning that the chunks that are being synchronized between nodes always travel alongside their corresponding postage stamps.</p>
<p>Pullsync&#x27;s role is to help synchronization of the chunks between neighborhood nodes. It bootstraps new nodes by filling up their storage with the chunks in range of their storage radius and also ensures eventual consistency - by making sure that the chunks will gradually migrate to their storer nodes.</p>
<p>There are two kinds of syncing:</p>
<ul>
<li>historical syncing: catching up with content that arrived to relevant neighborhood before this session started (after an outage or for completely new nodes).</li>
<li>live syncing: fetching the chunks that are received after the session has started.</li>
</ul>
<p>The chunks are served in batches (ordered by timestamp) and they cover contiguous ranges.</p>
<p>The downstream peers coordinate their syncing by requesting ranges from the upstream with the help of the &quot;interval store&quot; - to keep track of which ranges are left to be synchronized.</p>
<p>Because live syncing happens in sessions - it is inevitable that after a session is completed - the downstream peer disconnects and will be missing chunks that arrive later.</p>
<p>For this purpose the downstream peer will make a note about the timestamp of the last synced chunk on disconnect.</p>
<p>The point of the interval based approach is to cover those gaps that inevitably arise in between syncing sessions.</p>
<p>To save bandwidth, before the contents of the chunk is being sent over the wire, the upstream will sent a range of chunk addresses for approval. If the downstream decides that some (or all) addresses are desired - a confirmation message is sent to the upstream, to which it responds with the chunks mentioned in the request.</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="appendix-3">Appendix<a href="#appendix-3" class="hash-link" aria-label="Direct link to Appendix" title="Direct link to Appendix">​</a></h3>
<p>The protobuf definitions</p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Copyright 2020 The Swarm Authors. All rights reserved.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Use of this source code is governed by a BSD-style</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// license that can be found in the LICENSE file.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">package pullsync;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">option go_package = &quot;pb&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Syn {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Ack {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repeated uint64 Cursors = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Get {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  int32 Bin = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  uint64 Start = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Chunk {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Address = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes BatchID = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Offer {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  uint64 Topmost = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repeated Chunk Chunks = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Want {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes BitVector = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Delivery {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Address = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Data = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bytes Stamp = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="peer-rating">Peer rating<a href="#peer-rating" class="hash-link" aria-label="Direct link to Peer rating" title="Direct link to Peer rating">​</a></h3>
<p>When choosing a peer in relation to a given address - in addition to the distance between them - the Kademlia component will take into account two other factors:</p>
<ul>
<li>the historical performance of the given peer, both in terms of latencies and past occurrences of protocol misalignments.</li>
<li>the accounting aspect, peers with whom we have higher credit will be preferred.</li>
<li>we should also prioritise those downstream peers that managed to produce responses in a previously computed amount of time (that would take into consideration the average time needed for a hop multiplied by the expected number of hops needed to reach a target neighborhood).</li>
</ul>
<p>Kademila should be indexing peers by their proximity order and peers rating in order to prioritize peers based on their expected performance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="decision-strategy">Decision strategy<a href="#decision-strategy" class="hash-link" aria-label="Direct link to Decision strategy" title="Direct link to Decision strategy">​</a></h3>
<p>An optimal decision strategy will take into account both proximity order and peer rating to select (out of all connected peers) the best one to pass down the request.</p>
<p>At the implementation level the Kademlia component will offer (in exchange for a given address) a stateful iterator that the client (protocol) will use to get the &quot;next-best&quot; peer.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transport">Transport<a href="#transport" class="hash-link" aria-label="Direct link to Transport" title="Direct link to Transport">​</a></h3>
<p>A reliable network transport is required for the proper functionality of DISC protocols.</p>
<p>It can be a distinct component whose responsibilities would be ensuring delivery, re-tries on network issues and timeouts and optimal use of network related resources.</p>
<p>One example of usage for such a component could be embedding into the Kademlia driver so that the topology component is only concerned with overlay related operations, abstracting away any low level transport concerns.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ethersphere/docs.github.io/blob/master/docs/develop/contribute/protocols.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/develop/contribute/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#protocols-specifications" class="table-of-contents__link toc-highlight">Protocols specifications</a></li><li><a href="#proposal" class="table-of-contents__link toc-highlight">Proposal</a></li><li><a href="#hive" class="table-of-contents__link toc-highlight">Hive</a><ul><li><a href="#appendix" class="table-of-contents__link toc-highlight">Appendix</a></li></ul></li><li><a href="#kademlia" class="table-of-contents__link toc-highlight">Kademlia</a></li><li><a href="#push-and-pull-chunk-retrieval-and-syncing" class="table-of-contents__link toc-highlight">Push and pull: chunk retrieval and syncing</a><ul><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#incentivisation-strategy" class="table-of-contents__link toc-highlight">Incentivisation strategy</a></li></ul></li><li><a href="#retrieval" class="table-of-contents__link toc-highlight">Retrieval</a><ul><li><a href="#protocol-breach" class="table-of-contents__link toc-highlight">Protocol breach</a></li><li><a href="#request-chunk---sequence-diagram" class="table-of-contents__link toc-highlight">Request chunk - sequence diagram</a></li><li><a href="#request-chunk---flow-diagram" class="table-of-contents__link toc-highlight">Request chunk - flow diagram</a></li><li><a href="#appendix-1" class="table-of-contents__link toc-highlight">Appendix</a></li></ul></li><li><a href="#pushsync" class="table-of-contents__link toc-highlight">Pushsync</a><ul><li><a href="#multiplexing" class="table-of-contents__link toc-highlight">Multiplexing</a></li><li><a href="#appendix-2" class="table-of-contents__link toc-highlight">Appendix</a></li></ul></li><li><a href="#pullsync" class="table-of-contents__link toc-highlight">Pullsync</a><ul><li><a href="#appendix-3" class="table-of-contents__link toc-highlight">Appendix</a></li><li><a href="#peer-rating" class="table-of-contents__link toc-highlight">Peer rating</a></li><li><a href="#decision-strategy" class="table-of-contents__link toc-highlight">Decision strategy</a></li><li><a href="#transport" class="table-of-contents__link toc-highlight">Transport</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Swarm Foundation</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://ethswarm.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Homepage</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/wdghaQsGq5" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://beehive.ethswarm.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mattermost<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.reddit.com/r/ethswarm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ethswarm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.ethswarm.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/ethersphere/bee" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyleft © 2025.</div></div></div></footer></div>
</body>
</html>